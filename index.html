<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="/services-portfolio.png" />
    <title>Ferhaten Yani | Portfolio</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

    <style>
        /* Import secondary font for creative pairing - Space Mono for technical/code aesthetic */
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #fafafa;
            color: #18181b;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ================================
           CANVAS LAYERS
        ================================ */
        #particle-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50;
        }

        #aperture-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 80;
        }

        /* ================================
           HERO LAYER
        ================================ */
        #hero-layer {
            position: fixed;
            inset: 0;
            z-index: 60;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }

        #hero-layer > * {
            pointer-events: auto;
        }

        .scanned-text {
            opacity: 0;
            pointer-events: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-in {
            animation: fadeIn 1.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        /* ================================
           NAVIGATION LAYER
        ================================ */
        #nav-layer {
            position: fixed;
            inset: 0;
            z-index: 60;
            display: none;
            opacity: 0;
            filter: blur(12px);
        }

        #nav-layer.visible {
            display: block;
        }

        /* Zone labels initially hidden for staggered fade-in */
        #nav-layer .zone-label {
            opacity: 0;
            transform: translateY(8px);
        }

        /* Zone Areas (circular hit areas) */
        .zone {
            position: fixed;
            z-index: 61;
            cursor: pointer;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Projects - largest, much closer to center */
        .zone.top-left {
            width: clamp(145px, 21vw, 250px);
            height: clamp(145px, 21vw, 250px);
            top: calc(35% - clamp(72.5px, 10.5vw, 125px));
            left: calc(35% - clamp(72.5px, 10.5vw, 125px));
        }

        /* Skills - top-right */
        .zone.top-right {
            width: clamp(130px, 18vw, 200px);
            height: clamp(130px, 18vw, 200px);
            top: calc(25% - clamp(65px, 9vw, 100px));
            right: calc(28% - clamp(65px, 9vw, 100px));
        }

        /* About - bottom-left */
        .zone.bottom-left {
            width: clamp(140px, 19vw, 230px);
            height: clamp(140px, 19vw, 230px);
            bottom: calc(25% - clamp(70px, 9.5vw, 115px));
            left: calc(25% - clamp(70px, 9.5vw, 115px));
        }

        /* Contact - bottom-right, much closer to center */
        .zone.bottom-right {
            width: clamp(130px, 18vw, 220px);
            height: clamp(130px, 18vw, 220px);
            bottom: calc(35% - clamp(65px, 9vw, 110px));
            right: calc(35% - clamp(65px, 9vw, 110px));
        }

        /* Zone Labels */
        .zone-label {
            position: relative;
            font-size: 0.65rem;
            font-weight: 500;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: #18181b;
            opacity: 1;
            transition: color 0.4s ease, transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            pointer-events: none;
            z-index: 2;
        }

        /* Projects label - largest and bolder */
        .zone.top-left .zone-label {
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 0.18em;
        }

        /* Contact label - emphasized */
        .zone.bottom-right .zone-label {
            font-size: 0.8rem;
            font-weight: 600;
            letter-spacing: 0.18em;
        }

        /* About label - slightly larger */
        .zone.bottom-left .zone-label {
            font-size: 0.7rem;
        }

        .zone:hover .zone-label {
            color: #3f3f46;
        }


        /* Intro CTA overlay for hero-to-nav transition */
        .intro-cta-overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'IBM Plex Mono', monospace;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            font-weight: 500;
            letter-spacing: 0.05em;
            color: #18181b;
            z-index: 65;
            pointer-events: none;
            opacity: 0;
            text-align: center;
            white-space: nowrap;
        }

        /* Typewriter cursor */
        .intro-cta-overlay::after {
            content: '|';
            display: inline-block;
            margin-left: 2px;
            animation: typewriter-blink 0.7s step-end infinite;
            opacity: 0;
        }

        .intro-cta-overlay.typing::after {
            opacity: 1;
        }

        @keyframes typewriter-blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        /* Intro CTA responsive adjustments */
        @media (max-width: 600px) {
            .intro-cta-overlay {
                font-size: clamp(1rem, 3.5vw, 1.5rem);
            }
        }

        @media (max-width: 420px) {
            .intro-cta-overlay {
                font-size: clamp(0.8rem, 4vw, 1rem);
                white-space: normal;
                max-width: 90%;
            }
        }

        /* Back to Hero button */
        #back-hero-btn {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: #fafafa;
            background: #18181b;
            border: 1px solid #18181b;
            cursor: pointer;
            z-index: 62;
            transition: all 0.3s ease;
            padding: 14px 28px;
        }

        #back-hero-btn:hover {
            background: #3f3f46;
            border-color: #3f3f46;
        }

        /* ================================
           SECTION CONTAINERS
        ================================ */
        .section-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
        }

        .section-container.active {
            opacity: 1;
            pointer-events: auto;
            z-index: 90;
        }

        .section-content {
            max-width: 700px;
            padding: 40px;
            text-align: center;
        }

        .section-content h2 {
            font-size: clamp(2.5rem, 8vw, 5rem);
            font-weight: 600;
            letter-spacing: -0.03em;
            margin-bottom: 1.5rem;
        }

        .section-content p {
            font-size: 1rem;
            color: #71717a;
            line-height: 1.8;
            max-width: 500px;
            margin: 0 auto;
        }

        /* ================================
           CONTACT SECTION SPECIAL STYLES
           (Two-step: Email â†’ Message flow)
        ================================ */
        #section-contact .section-content {
            width: 100%;
            max-width: min(80vw, 1200px);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100%;
        }

        /* Contact Steps */
        .contact-step {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .contact-step h2 {
            position: relative;
            z-index: 10;
        }

        .contact-step > p {
            position: relative;
            z-index: 10;
            margin-bottom: 2rem;
        }

        /* Background preview text (fades in as user types) */
        .contact-preview {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(4rem, 15vw, 10rem);
            font-weight: 600;
            letter-spacing: -0.05em;
            color: #18181b;
            opacity: 0;
            pointer-events: none;
            z-index: 1;
            white-space: nowrap;
            transition: opacity 0.3s ease;
        }

        .contact-preview.visible {
            opacity: 0.08;
        }

        /* Email Input Wrapper */
        .contact-input-wrapper {
            margin-top: 1rem;
            position: relative;
            display: inline-block;
            width: 100%;
        }

        /* Large Typography Input for Email */
        .contact-input {
            font-family: 'Inter', sans-serif;
            font-size: clamp(2rem, 6vw, 4rem);
            font-weight: 600;
            letter-spacing: -0.04em;
            color: #18181b;
            background: transparent;
            border: none;
            outline: none;
            text-align: center;
            width: 100%;
            caret-color: #18181b;
        }

        .contact-input::placeholder {
            color: #d4d4d8;
        }

        .contact-input:focus::placeholder {
            color: #e4e4e7;
        }

        /* Invalid email shake animation */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-8px); }
            40%, 80% { transform: translateX(8px); }
        }

        .contact-input.invalid {
            animation: shake 0.4s ease;
            color: #ef4444;
        }

        /* Hint text */
        .contact-hint {
            margin-top: 1.5rem;
            font-size: 0.75rem;
            color: #a1a1aa;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            transition: opacity 0.3s ease, color 0.3s ease;
        }

        .contact-hint.error {
            color: #ef4444;
        }

        /* Next Button for Email Step */
        .contact-next-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 2rem;
            padding: 14px 28px;
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: #fafafa;
            background: #18181b;
            border: 1px solid #18181b;
            cursor: pointer;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .contact-next-btn.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .contact-next-btn:hover {
            background: #3f3f46;
            border-color: #3f3f46;
        }

        .contact-next-btn i {
            transition: transform 0.3s ease;
        }

        .contact-next-btn:hover i {
            transform: translateX(3px);
        }

        /* ================================
           STEP 2: MESSAGE INPUT
        ================================ */

        /* Email Badge at top */
        .contact-email-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #f4f4f5;
            border: 1px solid #e4e4e7;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .contact-email-badge span {
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            color: #71717a;
        }

        .contact-email-edit {
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            padding: 4px;
            cursor: pointer;
            color: #a1a1aa;
            transition: color 0.3s ease;
        }

        .contact-email-edit:hover {
            color: #18181b;
        }

        /* Message Textarea Wrapper */
        .contact-message-wrapper {
            width: 100%;
            position: relative;
        }

        /* Dynamic Font Size Message Input */
        .contact-message-input {
            font-family: 'Inter', sans-serif;
            font-size: clamp(1.5rem, 5vw, 3.5rem);
            font-weight: 600;
            letter-spacing: -0.03em;
            line-height: 1.2;
            color: #18181b;
            background: transparent;
            border: none;
            outline: none;
            text-align: center;
            width: 100%;
            resize: none;
            overflow: hidden;
            caret-color: #18181b;
            min-height: 1.5em;
            transition: font-size 0.2s ease;
        }

        .contact-message-input::placeholder {
            color: #d4d4d8;
        }

        .contact-message-input:focus::placeholder {
            color: #e4e4e7;
        }

        /* Send Button */
        .contact-send-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 2rem;
            padding: 14px 28px;
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: #fafafa;
            background: #18181b;
            border: 1px solid #18181b;
            cursor: pointer;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .contact-send-btn.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .contact-send-btn:hover {
            background: #3f3f46;
            border-color: #3f3f46;
        }

        .contact-send-btn i {
            transition: transform 0.3s ease;
        }

        .contact-send-btn:hover i {
            transform: translateX(3px);
        }

        /* Send button loading state */
        .contact-send-btn.loading {
            pointer-events: none;
            opacity: 0.8;
        }

        .contact-send-btn .btn-spinner {
            display: none;
            width: 14px;
            height: 14px;
            border: 2px solid transparent;
            border-top-color: #fafafa;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        .contact-send-btn.loading .btn-spinner {
            display: inline-block;
        }

        .contact-send-btn.loading .btn-icon {
            display: none;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Contact error message */
        .contact-error-message {
            margin-top: 1rem;
            padding: 12px 20px;
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            font-size: 0.75rem;
            letter-spacing: 0.02em;
            text-align: center;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .contact-error-message.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* ================================
           STEP 3: THANK YOU VIEW
        ================================ */
        .contact-thank-you {
            padding: 2rem;
        }

        .contact-thank-you-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 80px;
            height: 80px;
            border: 2px solid #18181b;
            border-radius: 50%;
            margin-bottom: 2rem;
            color: #18181b;
        }

        .contact-thank-you h2 {
            margin-bottom: 1rem;
        }

        .contact-thank-you p {
            margin-bottom: 2rem;
            color: #71717a;
        }

        .contact-reset-btn {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: #71717a;
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px 16px;
            transition: color 0.3s ease;
        }

        .contact-reset-btn:hover {
            color: #18181b;
        }

        /* ================================
           CONTACT MOBILE ADJUSTMENTS
        ================================ */
        @media (max-width: 768px) {
            .contact-input {
                font-size: clamp(1.5rem, 5vw, 2.5rem);
            }

            .contact-message-input {
                font-size: clamp(1.2rem, 4vw, 2rem);
            }

            .contact-preview {
                font-size: clamp(3rem, 12vw, 6rem);
            }

            .contact-email-badge {
                padding: 6px 12px;
            }

            .contact-email-badge span {
                font-size: 0.65rem;
            }

            .contact-send-btn {
                padding: 12px 24px;
                font-size: 0.65rem;
            }

            .contact-thank-you-icon {
                width: 60px;
                height: 60px;
            }

            .contact-thank-you-icon i {
                width: 32px;
                height: 32px;
            }
        }

        @media (max-width: 480px) {
            .contact-input {
                font-size: clamp(1.2rem, 6vw, 1.8rem);
            }

            .contact-message-input {
                font-size: clamp(1rem, 5vw, 1.5rem);
            }

            .contact-hint {
                font-size: 0.65rem;
            }

            .contact-email-badge span {
                font-size: 0.6rem;
            }
        }

        /* ================================
           SKILLS SECTION
        ================================ */
        #section-skills {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: clamp(16px, 4vh, 40px) clamp(16px, 4vw, 40px);
        }

        .skills-content {
            width: 100%;
            max-width: 1100px;
            display: flex;
            flex-direction: column;
            gap: clamp(24px, 4vh, 48px);
        }

        .skills-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: clamp(20px, 3vw, 48px);
        }

        .skills-grid-bottom {
            grid-template-columns: repeat(2, 1fr);
            max-width: 66.666%;
            margin: 0 auto;
        }

        .skill-category {
            text-align: center;
            cursor: pointer;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        .skill-title {
            font-family: 'Space Mono', monospace;
            font-size: clamp(0.65rem, 1.2vw, 0.85rem);
            font-weight: 700;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: #18181b;
            margin-bottom: clamp(8px, 1.5vh, 14px);
        }

        .skill-separator {
            width: 24px;
            height: 1px;
            background: #d4d4d8;
            margin: 0 auto clamp(10px, 1.5vh, 16px);
            transition: width 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .skill-category:hover .skill-separator,
        .skill-category:focus .skill-separator,
        .skill-category.active .skill-separator {
            width: 100%;
        }

        .skill-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: clamp(4px, 0.8vh, 8px);
        }

        .skill-list li {
            font-family: 'Inter', sans-serif;
            font-size: clamp(0.7rem, 1.1vw, 0.875rem);
            font-weight: 400;
            color: #71717a;
            line-height: 1.5;
            transition: color 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .skill-category:hover .skill-list li,
        .skill-category:focus .skill-list li,
        .skill-category.active .skill-list li {
            color: #18181b;
        }

        /* Tablet breakpoint */
        @media (max-width: 900px) {
            .skills-grid {
                gap: clamp(16px, 2.5vw, 32px);
            }

            .skills-grid-bottom {
                max-width: 80%;
            }
        }

        /* Mobile breakpoint */
        @media (max-width: 640px) {
            #section-skills {
                padding: clamp(12px, 3vh, 24px) clamp(12px, 3vw, 24px);
            }

            .skills-content {
                gap: clamp(16px, 3vh, 28px);
            }

            .skills-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: clamp(12px, 2vw, 20px);
            }

            .skills-grid-bottom {
                grid-template-columns: repeat(2, 1fr);
                max-width: 66.666%;
            }

            .skill-title {
                font-size: clamp(0.5rem, 2.5vw, 0.65rem);
                letter-spacing: 0.08em;
                margin-bottom: clamp(6px, 1vh, 10px);
            }

            .skill-separator {
                width: 16px;
                margin-bottom: clamp(6px, 1vh, 10px);
            }

            .skill-list li {
                font-size: clamp(0.55rem, 2.2vw, 0.7rem);
            }

            .skill-list {
                gap: clamp(2px, 0.5vh, 5px);
            }
        }

        /* Extra small mobile */
        @media (max-width: 420px) {
            .skills-grid {
                grid-template-columns: 1fr;
                gap: clamp(18px, 4vh, 28px);
            }

            .skills-grid-bottom {
                grid-template-columns: 1fr;
                max-width: 100%;
            }

            .skill-title {
                font-size: 0.7rem;
                letter-spacing: 0.1em;
            }

            .skill-list li {
                font-size: 0.75rem;
            }

            .skill-separator {
                width: 24px;
            }
        }

        /* Very small screens (340px) */
        @media (max-width: 360px) {
            #section-skills {
                padding: 10px;
            }

            .skills-content {
                gap: 14px;
            }

            .skill-title {
                font-size: 0.6rem;
                margin-bottom: 5px;
            }

            .skill-list li {
                font-size: 0.65rem;
            }

            .skill-list {
                gap: 2px;
            }
        }

        /* ================================
           PROJECTS SECTION
        ================================ */
        #section-projects {
            padding: 0;
            padding-top: 80px;
        }

        #section-projects .section-content {
            max-width: 100%;
            width: 100%;
            height: 100%;
            padding: 0;
            display: flex;
            flex-direction: column;
        }

        /* Projects Header with Tabs */
        .projects-header {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: clamp(20px, 4vh, 40px) clamp(20px, 4vw, 60px);
            gap: clamp(8px, 2vw, 24px);
            position: relative;
        }

        /* Close button positioning for projects section */
        #section-projects .close-btn-projects {
            position: fixed;
            top: 30px;
            right: 30px;
            transform: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #18181b;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: background 0.3s ease, transform 0.3s ease, opacity 0.3s ease;
            z-index: 200;
        }

        #section-projects .close-btn-projects:hover {
            background: #3f3f46;
            transform: scale(1.05);
        }

        #section-projects .close-btn-projects.visible {
            opacity: 1;
            pointer-events: auto;
        }

        #section-projects .close-btn-projects::before,
        #section-projects .close-btn-projects::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 2px;
            background: #fafafa;
        }

        #section-projects .close-btn-projects::before {
            transform: rotate(45deg);
        }

        #section-projects .close-btn-projects::after {
            transform: rotate(-45deg);
        }

        .project-tab {
            font-family: 'Space Mono', monospace;
            font-size: clamp(0.6rem, 1.2vw, 0.75rem);
            font-weight: 400;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: #a1a1aa;
            background: none;
            border: none;
            padding: 8px 16px;
            cursor: pointer;
            position: relative;
            transition: color 0.3s ease;
        }

        .project-tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 1px;
            background: #18181b;
            transition: width 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .project-tab:hover {
            color: #71717a;
        }

        .project-tab.active {
            color: #18181b;
            font-weight: 700;
        }

        .project-tab.active::after {
            width: 100%;
        }

        /* Projects Carousel Container */
        .projects-carousel {
            flex: 1;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
        }

        .projects-track {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .project-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: clamp(20px, 4vw, 60px);
            padding-left: clamp(60px, 8vw, 100px);
            padding-right: clamp(60px, 8vw, 100px);
            box-sizing: border-box;
            opacity: 0;
            pointer-events: none;
            overflow-y: auto;
            overflow-x: hidden;
            transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .project-slide.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* Custom scrollbar for project slides */
        .project-slide::-webkit-scrollbar {
            width: 6px;
        }

        .project-slide::-webkit-scrollbar-track {
            background: transparent;
        }

        .project-slide::-webkit-scrollbar-thumb {
            background: #d4d4d8;
            border-radius: 3px;
        }

        .project-slide::-webkit-scrollbar-thumb:hover {
            background: #a1a1aa;
        }

        .project-content {
            max-width: 900px;
            width: 100%;
            text-align: center;
        }

        

        /* Project Title */
        .project-title {
            font-size: clamp(1.8rem, 5vw, 3rem);
            font-weight: 600;
            letter-spacing: -0.03em;
            color: #18181b;
            margin-bottom: 1rem;
            line-height: 1.1;
        }

        /* Project Description */
        .project-description {
            font-size: clamp(0.85rem, 1.5vw, 1rem);
            color: #71717a;
            line-height: 1.7;
            max-width: 600px;
            margin: 0 auto 1.5rem;
        }

        /* Project Tags */
        .project-tags {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin-bottom: 2rem;
        }

        .project-tag {
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: #71717a;
            padding: 6px 12px;
            border: 1px solid #e4e4e7;
            transition: all 0.3s ease;
        }

        .project-tag:hover {
            border-color: #a1a1aa;
            color: #18181b;
        }

        /* Project Link Button */
        .project-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.7rem;
            font-weight: 500;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: #18181b;
            text-decoration: none;
            padding: 12px 24px;
            border: 1px solid #18181b;
            transition: all 0.3s ease;
        }

        .project-link:hover {
            background: #18181b;
            color: #fafafa;
        }

        .project-link i {
            width: 14px;
            height: 14px;
            transition: transform 0.3s ease;
        }

        .project-link:hover i {
            transform: translateX(2px);
        }

        /* Navigation Arrows */
        .project-nav-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 44px;
            height: 44px;
            background: transparent;
            border: 1px solid #d4d4d8;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .project-nav-arrow:hover {
            border-color: #18181b;
            background: #18181b;
        }

        .project-nav-arrow:hover i {
            stroke: #fafafa;
        }

        .project-nav-arrow i {
            width: 18px;
            height: 18px;
            stroke: #71717a;
            transition: stroke 0.3s ease;
        }

        .project-nav-arrow.prev {
            left: clamp(20px, 4vw, 50px);
        }

        .project-nav-arrow.next {
            right: clamp(20px, 4vw, 50px);
        }

        .project-nav-arrow:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            pointer-events: none;
        }

        /* Project 2 Specific - Image Gallery */
        .project-gallery {
            margin: 1.5rem 0;
        }

        .gallery-toggle {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 1rem;
        }

        .gallery-toggle-btn {
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: #fafafa;
            background: #18181b;
            border: 1px solid #18181b;
            padding: 10px 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .gallery-toggle-btn:hover {
            background: #3f3f46;
            border-color: #3f3f46;
        }

        .gallery-toggle-btn.active {
            color: #fafafa;
            border-color: #18181b;
            background: #18181b;
            box-shadow: 0 2px 8px rgba(24, 24, 27, 0.3);
        }

        .gallery-toggle-btn:not(.active) {
            color: #71717a;
            background: #fafafa;
            border-color: #d4d4d8;
        }

        .gallery-toggle-btn:not(.active):hover {
            color: #18181b;
            background: #f4f4f5;
            border-color: #a1a1aa;
        }

        .gallery-toggle-btn i {
            width: 14px;
            height: 14px;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            max-height: 280px;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 8px;
            scrollbar-width: thin;
            scrollbar-color: #d4d4d8 transparent;
        }

        .gallery-grid::-webkit-scrollbar {
            width: 6px;
        }

        .gallery-grid::-webkit-scrollbar-track {
            background: transparent;
        }

        .gallery-grid::-webkit-scrollbar-thumb {
            background: #d4d4d8;
            border-radius: 3px;
        }

        .gallery-grid::-webkit-scrollbar-thumb:hover {
            background: #a1a1aa;
        }

        .gallery-item {
            aspect-ratio: 4/3;
            background: #f4f4f5;
            border: 1px solid #e4e4e7;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .gallery-item:hover {
            border-color: #18181b;
            transform: scale(1.02);
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* ================================
           CASE STUDY STYLES (Project 2)
        ================================ */
        .case-study-container {
            position: relative;
            width: 100%;
            max-height: 680px;
            overflow: hidden;
        }

        .case-study-content {
            display: none;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .case-study-content.active {
            display: block;
            opacity: 1;
        }

        /* Scroll container for panels */
        .case-study-scroll {
            display: flex;
            overflow-x: auto;
            overflow-y: hidden;
            scroll-snap-type: x mandatory;
            scroll-behavior: smooth;
            scrollbar-width: none;
            -ms-overflow-style: none;
            -webkit-overflow-scrolling: touch;
            height: 640px;
        }

        .case-study-scroll::-webkit-scrollbar {
            display: none;
        }

        /* Intro panel styling */
        .case-study-intro {
            min-width: 100%;
            height: 100%;
            scroll-snap-align: start;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem 1.5rem;
            text-align: center;
            background: #f4f4f5;
        }

        .case-study-intro .case-study-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            margin-bottom: 1rem;
            background: #fafafa;
            border: 1px solid #e4e4e7;
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: #71717a;
        }

        .case-study-intro .case-study-badge .pulse-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #18181b;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        .case-study-intro h3 {
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: 600;
            color: #18181b;
            margin-bottom: 0.75rem;
            letter-spacing: -0.02em;
        }

        .case-study-intro p {
            font-size: 0.85rem;
            color: #71717a;
            line-height: 1.6;
            max-width: 400px;
        }

        /* Feature panel styling */
        .case-study-panel {
            min-width: 100%;
            height: 100%;
            scroll-snap-align: start;
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
            background: #fafafa;
        }

        .case-study-panel:nth-child(odd) {
            background: #f4f4f5;
        }

        .case-study-panel-header {
            flex-shrink: 0;
            margin-bottom: 1rem;
            text-align: center;
        }

        .case-study-panel-label {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: #a1a1aa;
            margin-bottom: 0.5rem;
        }

        .case-study-panel-label .dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #18181b;
        }

        .case-study-panel-title {
            font-size: clamp(1.1rem, 3vw, 1.4rem);
            font-weight: 600;
            color: #18181b;
            margin-bottom: 0.4rem;
            letter-spacing: -0.01em;
        }

        .case-study-panel-desc {
            font-size: 0.75rem;
            color: #71717a;
            line-height: 1.5;
            max-width: 500px;
            margin: 0 auto;
        }

        /* Mockups container */
        .case-study-mockups {
            flex: 1;
            display: flex;
            gap: 16px;
            align-items: center;
            justify-content: center;
            overflow: visible;
            padding: 1.5rem 1rem;
            min-height: 440px;
            flex-wrap: wrap;
        }

        /* Mobile app mockups (stacked/rotated style) */
        .case-study-mockup {
            position: relative;
            border: 1px solid #e4e4e7;
            background: #fafafa;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .case-study-mockup.mockup-primary {
            height: 58vh;
            max-height: 540px;
            width: auto;
            transform: rotate(-2deg);
            z-index: 3;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        }

        .case-study-mockup.mockup-secondary {
            height: 52vh;
            max-height: 480px;
            width: auto;
            transform: rotate(1.5deg);
            z-index: 2;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.06);
        }

        .case-study-mockup.mockup-tertiary {
            height: 46vh;
            max-height: 420px;
            width: auto;
            transform: rotate(-1deg);
            z-index: 1;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .case-study-mockup:hover {
            transform: scale(1.02) rotate(0deg);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
            z-index: 10;
        }

        .case-study-mockup img {
            height: 100%;
            width: auto;
            object-fit: contain;
        }

        /* Desktop mockups (admin - single image per frame style) */
        .case-study-mockup.mockup-desktop {
            height: auto;
            max-height: 65vh;
            max-width: 100%;
            width: auto;
            transform: none;
            border-radius: 0;
        }

        .case-study-mockup.mockup-desktop:hover {
            transform: scale(1.01);
        }

        .case-study-mockup.mockup-desktop img {
            width: auto;
            height: auto;
            max-height: 65vh;
            max-width: 100%;
            object-fit: contain;
        }

        /* Navigation arrows for case study */
        .case-study-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fafafa;
            border: 1px solid #e4e4e7;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
            opacity: 0;
        }

        .case-study-container:hover .case-study-nav {
            opacity: 1;
        }

        .case-study-nav:hover {
            background: #18181b;
            border-color: #18181b;
        }

        .case-study-nav:hover svg {
            stroke: #fafafa;
        }

        .case-study-nav svg {
            width: 14px;
            height: 14px;
            stroke: #71717a;
            stroke-width: 1.5;
        }

        .case-study-nav.prev {
            left: 8px;
        }

        .case-study-nav.next {
            right: 8px;
        }

        .case-study-nav.disabled {
            opacity: 0.3;
            pointer-events: none;
        }

        /* Progress indicator */
        .case-study-progress {
            display: flex;
            justify-content: center;
            gap: 6px;
            padding: 10px 0;
        }

        .case-study-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #d4d4d8;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .case-study-dot.active {
            background: #18181b;
            width: 20px;
            border-radius: 3px;
        }

        .case-study-dot:hover:not(.active) {
            background: #a1a1aa;
        }

        /* Responsive adjustments for case study */
        @media (max-width: 1024px) {
            .case-study-container {
                max-height: 550px;
            }

            .case-study-scroll {
                scroll-snap-type: y mandatory;
                flex-direction: column;
                overflow-x: hidden;
                overflow-y: auto;
                height: 520px;
            }

            .case-study-intro,
            .case-study-panel {
                min-width: unset;
                min-height: 100%;
                scroll-snap-align: start;
            }

            /* Vertical layout for panels */
            .case-study-panel {
                display: flex;
                flex-direction: column;
                padding: 1.5rem;
            }

            .case-study-panel-header {
                flex: 0 0 auto;
                margin-bottom: 1.5rem;
            }

            .case-study-mockups {
                flex: 0 0 auto;
                flex-wrap: wrap;
                min-height: auto;
                margin-top: 1rem;
                gap: 1rem;
            }

            .case-study-mockup.mockup-primary {
                height: 50vh;
                max-height: 420px;
            }

            .case-study-mockup.mockup-secondary {
                height: 44vh;
                max-height: 370px;
            }

            .case-study-mockup.mockup-tertiary {
                height: 38vh;
                max-height: 320px;
            }

            .case-study-mockup.mockup-desktop {
                max-height: 55vh;
            }

            .case-study-mockup.mockup-desktop img {
                max-height: 55vh;
            }

            .case-study-nav {
                display: none;
            }

            #case-study-project2 .case-study-progress {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .case-study-container {
                max-height: 500px;
            }

            .case-study-scroll {
                height: 470px;
            }

            .case-study-panel {
                display: flex;
                flex-direction: column;
                padding: 1.25rem;
                padding-bottom: 4rem;
            }

            .case-study-panel-header {
                flex: 0 0 auto;
                margin-bottom: 1.25rem;
            }

            .case-study-mockups {
                flex: 0 0 auto;
                min-height: auto;
                gap: 1rem;
                margin-top: 0.75rem;
            }

            .case-study-mockup.mockup-primary {
                height: 45vh;
                max-height: 380px;
            }

            .case-study-mockup.mockup-secondary {
                height: 40vh;
                max-height: 340px;
            }

            .case-study-mockup.mockup-tertiary {
                height: 35vh;
                max-height: 300px;
            }

            .case-study-mockup.mockup-desktop {
                max-height: 50vh;
            }

            .case-study-mockup.mockup-desktop img {
                max-height: 50vh;
            }

            .case-study-panel-title {
                font-size: 1.1rem;
            }

            .case-study-panel-desc {
                font-size: 0.7rem;
            }
        }

        @media (max-width: 640px) {
            .case-study-container {
                max-height: none;
                overflow: visible;
            }

            .case-study-scroll {
                height: auto;
                min-height: 100%;
            }

            .case-study-panel {
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 2rem 1rem;
                padding-bottom: 5rem;
                min-height: auto;
            }

            .case-study-panel-header {
                flex: 0 0 auto;
                text-align: center;
                margin-bottom: 2rem;
                width: 100%;
            }

            .case-study-mockups {
                flex: 0 0 auto;
                min-height: auto;
                gap: 1.25rem;
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                align-items: center;
                margin-top: 0;
                width: 100%;
            }

            /* Dribbble-style mobile mockups */
            .case-study-mockup.mockup-primary {
                height: auto;
                max-height: none;
                width: 55%;
                max-width: 180px;
                transform: rotate(-2deg) translateY(-8px);
            }

            .case-study-mockup.mockup-secondary {
                height: auto;
                max-height: none;
                width: 50%;
                max-width: 165px;
                transform: rotate(1.5deg) translateY(4px);
            }

            .case-study-mockup.mockup-tertiary {
                height: auto;
                max-height: none;
                width: 45%;
                max-width: 150px;
                transform: rotate(-1deg) translateY(0px);
            }

            .case-study-mockup img {
                width: 100%;
                height: auto;
            }

            .case-study-mockup.mockup-desktop {
                max-height: 45vh;
                width: auto;
            }

            .case-study-mockup.mockup-desktop img {
                max-height: 45vh;
                width: auto;
            }

            .case-study-intro {
                padding: 2rem 1.25rem;
                padding-bottom: 4rem;
            }

            .case-study-intro h3 {
                font-size: 1.4rem;
            }

            .case-study-intro p {
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .case-study-container {
                max-height: none;
                overflow: visible;
            }

            .case-study-scroll {
                height: auto;
                min-height: 100%;
            }

            .case-study-panel {
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 1.75rem 0.875rem;
                padding-bottom: 4.5rem;
            }

            .case-study-panel-header {
                flex: 0 0 auto;
                text-align: center;
                margin-bottom: 1.75rem;
                width: 100%;
            }

            .case-study-mockups {
                flex: 0 0 auto;
                min-height: auto;
                gap: 1rem;
                margin-top: 0;
            }

            .case-study-intro {
                padding: 1.5rem 1rem;
                padding-bottom: 4rem;
            }

            .case-study-intro h3 {
                font-size: 1.3rem;
            }

            .case-study-intro p {
                font-size: 0.75rem;
            }

            .case-study-mockup.mockup-primary {
                width: 52%;
                max-width: 165px;
            }

            .case-study-mockup.mockup-secondary {
                width: 48%;
                max-width: 150px;
            }

            .case-study-mockup.mockup-tertiary {
                width: 44%;
                max-width: 140px;
            }

            .case-study-mockup.mockup-desktop {
                max-height: 40vh;
            }

            .case-study-mockup.mockup-desktop img {
                max-height: 40vh;
            }

            .case-study-progress {
                padding: 8px 0;
                gap: 4px;
            }

            .case-study-dot {
                width: 5px;
                height: 5px;
            }

            .case-study-dot.active {
                width: 16px;
            }
        }

        @media (max-width: 375px) {
            .case-study-container {
                max-height: none;
                overflow: visible;
            }

            .case-study-scroll {
                height: auto;
                min-height: 100%;
            }

            .case-study-panel {
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 1.5rem 0.75rem;
                padding-bottom: 4rem;
            }

            .case-study-panel-header {
                flex: 0 0 auto;
                text-align: center;
                margin-bottom: 1.5rem;
                width: 100%;
            }

            .case-study-mockups {
                flex: 0 0 auto;
                min-height: auto;
                gap: 0.875rem;
                margin-top: 0;
            }

            .case-study-mockup.mockup-primary {
                width: 50%;
                max-width: 150px;
            }

            .case-study-mockup.mockup-secondary {
                width: 46%;
                max-width: 140px;
            }

            .case-study-mockup.mockup-tertiary {
                width: 42%;
                max-width: 130px;
            }

            .case-study-mockup.mockup-desktop {
                max-height: 35vh;
            }

            .case-study-mockup.mockup-desktop img {
                max-height: 35vh;
            }
        }

        /* Project 3 Specific - Video */
        .project-video-container {
            margin: 1.5rem auto;
            max-width: 900px;
            width: 100%;
            aspect-ratio: 16/9;
            background: #f4f4f5;
            border: 1px solid #e4e4e7;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .project-video-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            color: #a1a1aa;
        }

        .video-placeholder i {
            width: 48px;
            height: 48px;
            stroke-width: 1;
        }

        .video-placeholder span {
            font-size: 0.7rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        /* Project 3 Gallery - reusing Project 2 pattern */
        #project3-user-view,
        #project3-admin-view {
            width: 100%;
        }

        /* Tablet Adjustments for Projects */
        @media (max-width: 900px) {
            .project-slide {
                padding: clamp(20px, 3vw, 40px);
                padding-left: clamp(70px, 10vw, 100px);
                padding-right: clamp(70px, 10vw, 100px);
            }

            .project-nav-arrow.prev {
                left: clamp(16px, 3vw, 30px);
            }

            .project-nav-arrow.next {
                right: clamp(16px, 3vw, 30px);
            }
        }

        /* Mobile Adjustments for Projects */
        @media (max-width: 768px) {
            #section-projects {
                padding-top: 70px;
            }

            .projects-header {
                padding: 16px 20px;
            }

            #section-projects .close-btn-projects {
                top: 20px;
                right: 20px;
                width: 44px;
                height: 44px;
            }

            #section-projects .close-btn-projects::before,
            #section-projects .close-btn-projects::after {
                width: 14px;
            }

            .project-tab {
                font-size: 0.6rem;
                padding: 8px 12px;
            }

            .project-slide {
                padding: 20px;
                padding-left: clamp(55px, 14vw, 80px);
                padding-right: clamp(55px, 14vw, 80px);
            }

            .project-nav-arrow {
                width: 40px;
                height: 40px;
            }

            .project-nav-arrow i {
                width: 16px;
                height: 16px;
            }

            .project-nav-arrow.prev {
                left: 12px;
            }

            .project-nav-arrow.next {
                right: 12px;
            }

            .gallery-grid {
                grid-template-columns: repeat(2, 1fr);
                max-height: 200px;
            }

            .project-video-container {
                max-width: 100%;
            }

            .project-title {
                font-size: clamp(1.5rem, 5vw, 2.2rem);
            }

            .project-description {
                font-size: clamp(0.8rem, 2.5vw, 0.95rem);
                line-height: 1.6;
            }
        }

        @media (max-width: 480px) {
            #section-projects {
                padding-top: 60px;
            }

            #section-projects .close-btn-projects {
                top: 16px;
                right: 16px;
                width: 40px;
                height: 40px;
            }

            #section-projects .close-btn-projects::before,
            #section-projects .close-btn-projects::after {
                width: 16px;
            }

            .project-slide {
                padding: 16px;
                padding-left: clamp(50px, 16vw, 70px);
                padding-right: clamp(50px, 16vw, 70px);
            }

            .project-nav-arrow {
                width: 36px;
                height: 36px;
            }

            .project-nav-arrow i {
                width: 14px;
                height: 14px;
            }

            .project-nav-arrow.prev {
                left: 8px;
            }

            .project-nav-arrow.next {
                right: 8px;
            }

            .project-title {
                font-size: clamp(1.3rem, 6vw, 1.6rem);
            }

            .project-description {
                font-size: 0.8rem;
            }

            .project-tags {
                gap: 6px;
            }

            .project-tag {
                font-size: 0.55rem;
                padding: 4px 8px;
            }

            .gallery-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }

            .project-number {
                width: 28px;
                height: 28px;
                font-size: 0.6rem;
                margin-bottom: 1rem;
            }
        }

        /* Extra small mobile */
        @media (max-width: 360px) {
            .project-slide {
                padding: 12px;
                padding-left: 48px;
                padding-right: 48px;
            }

            .project-nav-arrow {
                width: 32px;
                height: 32px;
            }

            .project-nav-arrow i {
                width: 12px;
                height: 12px;
            }

            .project-nav-arrow.prev {
                left: 6px;
            }

            .project-nav-arrow.next {
                right: 6px;
            }

            .project-tab {
                font-size: 0.5rem;
                padding: 6px 8px;
            }

            .project-title {
                font-size: 1.2rem;
            }

            .project-description {
                font-size: 0.75rem;
            }
        }

        /* ================================
           CLOSE BUTTON
        ================================ */
        .close-btn {
            position: fixed;
            top: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #18181b;
            border: none;
            cursor: pointer;
            z-index: 200;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: background 0.3s ease, transform 0.3s ease;
        }

        .close-btn:hover {
            background: #3f3f46;
            transform: scale(1.05);
        }

        .close-btn.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .close-btn::before,
        .close-btn::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 2px;
            background: #fafafa;
        }

        .close-btn::before {
            transform: rotate(45deg);
        }

        .close-btn::after {
            transform: rotate(-45deg);
        }

        /* ================================
           MOBILE ADJUSTMENTS
        ================================ */
        /* ================================
           LANGUAGE TOGGLE
        ================================ */
        #lang-toggle {
            position: fixed;
            top: 30px;
            left: 30px;
            z-index: 300;
            display: flex;
            gap: 0;
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.08em;
            background: transparent;
            border: 1px solid #d4d4d8;
            overflow: hidden;
        }

        #lang-toggle button {
            padding: 10px 14px;
            background: transparent;
            border: none;
            color: #a1a1aa;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        #lang-toggle button::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 1px;
            height: 60%;
            background: #d4d4d8;
        }

        #lang-toggle button:last-child::after {
            display: none;
        }

        #lang-toggle button:hover {
            color: #71717a;
        }

        #lang-toggle button.active {
            background: #18181b;
            color: #fafafa;
        }

        #lang-toggle button.active::after {
            display: none;
        }

        /* Ensure toggle is always visible on all layers */
        #lang-toggle.visible {
            opacity: 1;
            pointer-events: auto;
        }

        @media (max-width: 768px) {
            #lang-toggle {
                top: 20px;
                left: 20px;
                font-size: 0.6rem;
            }

            #lang-toggle button {
                padding: 8px 12px;
            }
        }

        @media (max-width: 480px) {
            #lang-toggle {
                top: 16px;
                left: 16px;
                font-size: 0.55rem;
            }

            #lang-toggle button {
                padding: 7px 10px;
            }
        }

        @media (max-width: 768px) {
            /* Projects - largest, much closer to center */
            .zone.top-left {
                width: clamp(110px, 26vw, 160px);
                height: clamp(110px, 26vw, 160px);
                top: calc(35% - clamp(55px, 13vw, 80px));
                left: calc(35% - clamp(55px, 13vw, 80px));
            }

            /* Skills - larger zone for better label spacing */
            .zone.top-right {
                width: clamp(110px, 28vw, 140px);
                height: clamp(110px, 28vw, 140px);
                top: calc(25% - clamp(55px, 14vw, 70px));
                right: calc(28% - clamp(55px, 14vw, 70px));
            }

            /* About - larger zone for better label spacing */
            .zone.bottom-left {
                width: clamp(120px, 30vw, 150px);
                height: clamp(120px, 30vw, 150px);
                bottom: calc(25% - clamp(60px, 15vw, 75px));
                left: calc(25% - clamp(60px, 15vw, 75px));
            }

            /* Contact - much closer to center */
            .zone.bottom-right {
                width: clamp(100px, 24vw, 145px);
                height: clamp(100px, 24vw, 145px);
                bottom: calc(35% - clamp(50px, 12vw, 72.5px));
                right: calc(35% - clamp(50px, 12vw, 72.5px));
            }

            .zone-label {
                font-size: 0.55rem;
            }

            .zone.top-left .zone-label {
                font-size: 0.7rem;
                font-weight: 600;
            }

            .zone.bottom-right .zone-label {
                font-size: 0.65rem;
                font-weight: 600;
            }

            .zone.bottom-left .zone-label {
                font-size: 0.6rem;
            }

            .close-btn {
                top: 20px;
                right: 20px;
                width: 44px;
                height: 44px;
            }

            #back-hero-btn {
                bottom: 20px;
                padding: 12px 24px;
                font-size: 0.65rem;
            }
        }

        @media (max-width: 480px) {
            .close-btn {
                top: 16px;
                right: 16px;
                width: 40px;
                height: 40px;
            }

            .close-btn::before,
            .close-btn::after {
                width: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- Language Toggle -->
    <div id="lang-toggle" class="visible">
        <button id="lang-en" class="active" data-lang="en">EN</button>
        <button id="lang-fr" data-lang="fr">FR</button>
    </div>

    <!-- Canvas Layers -->
    <canvas id="particle-canvas"></canvas>
    <canvas id="aperture-canvas"></canvas>

    <!-- ================================
         HERO LAYER
    ================================ -->
    <div id="hero-layer">
        

        <!-- Target Text for Particle System -->
        <div class="relative w-full flex flex-col items-center justify-center mb-12">
            <h1 id="text-name" class="scanned-text text-5xl md:text-7xl font-semibold tracking-tighter text-zinc-900 mb-6 leading-tight" data-i18n="hero.name">
                Ferhaten Yani
            </h1>
            <h2 id="text-role" class="scanned-text text-xl md:text-2xl font-medium text-zinc-1000 tracking-tight uppercase" data-i18n="hero.role">
                Frontend Dev & UI/UX Designer
            </h2>
        </div>

        <!-- Trigger Button -->
        <button id="cta-btn" class="group relative px-6 py-2.5 bg-transparent border border-zinc-900 hover:bg-zinc-900/10 text-zinc-900 text-xs md:text-sm font-medium tracking-wide rounded-full transition-all duration-300 ease-out flex items-center gap-2" style="opacity: 0; pointer-events: none;">
            <span class="relative z-10" data-i18n="hero.cta">Enter Portfolio</span>
            <i data-lucide="arrow-right" class="w-3.5 h-3.5 relative z-10 transition-transform duration-300 group-hover:translate-x-0.5" stroke-width="1.5"></i>
        </button>
    </div>

    <!-- Intro CTA Overlay (appears first during hero-to-nav transition, outside nav-layer) -->
    <div class="intro-cta-overlay" id="intro-cta-overlay" data-i18n="nav.introCta">Click a section to explore</div>

    <!-- ================================
         NAVIGATION LAYER
    ================================ -->
    <div id="nav-layer">
        <!-- Center Hint -->

        <!-- Zone Hit Areas -->
        <div class="zone top-left" data-section="projects">
            <span class="zone-label" data-i18n="nav.projects">Projects</span>
        </div>
        <div class="zone top-right" data-section="skills">
            <span class="zone-label" data-i18n="nav.skills">Skills</span>
        </div>
        <div class="zone bottom-left" data-section="about">
            <span class="zone-label" data-i18n="nav.about">About</span>
        </div>
        <div class="zone bottom-right" data-section="contact">
            <span class="zone-label" data-i18n="nav.contact">Contact</span>
        </div>

        <!-- Back to Hero Button --> 
        <button id="back-hero-btn" data-i18n="nav.backToStart">Back to Start</button>
    </div>

    <!-- Close Button (shared) -->
    <button class="close-btn" id="close-btn" aria-label="Close section"></button>

    <!-- ================================
         SECTION CONTAINERS
    ================================ -->
    <div class="section-container" id="section-projects">
        <!-- Close button for projects section -->
        <button class="close-btn-projects" id="close-btn-projects" aria-label="Close section"></button>
        <div class="section-content">
            <!-- Projects Header with Tabs -->
            <div class="projects-header">
                <button class="project-tab active" data-project="0" data-i18n="projects.tabs.project1">Project 1</button>
                <button class="project-tab" data-project="1" data-i18n="projects.tabs.project2">Project 2</button>
                <button class="project-tab" data-project="2" data-i18n="projects.tabs.project3">Project 3</button>
            </div>

            <!-- Projects Carousel -->
            <div class="projects-carousel">
                <!-- Navigation Arrows -->
                <button class="project-nav-arrow prev" id="project-prev" disabled>
                    <i data-lucide="chevron-left" stroke-width="1.5"></i>
                </button>
                <button class="project-nav-arrow next" id="project-next">
                    <i data-lucide="chevron-right" stroke-width="1.5"></i>
                </button>

                <!-- Projects Track -->
                <div class="projects-track" id="projects-track">
                    <!-- Project 1: Power BI Dashboard -->
                    <div class="project-slide" data-index="0">
                        <div class="project-content">
                            <h2 class="project-title" data-i18n="projects.project1.title">ReportHub</h2>
                            <p class="project-description" data-i18n="projects.project1.description">
                                A modern SaaS application featuring embedded Power BI dashboards, designed with a clear separation between User and Admin experiences. The focus is on data clarity, role-based access, and smooth interactions, delivering complex analytics through a clean, intuitive interface.
                            </p>
                            <div class="project-tags">
                                <span class="project-tag">React</span>
                                <span class="project-tag">Tailwind CSS</span>
                                <span class="project-tag">TypeScript</span>
                                <span class="project-tag">Framer Motion</span>
                            </div>
                            <a href="#" class="project-link" target="_blank" rel="noopener">
                                <span data-i18n="projects.project1.viewDemo">View Live Demo</span>
                                <i data-lucide="arrow-right" stroke-width="1.5"></i>
                            </a>
                        </div>
                    </div>

                    <!-- Project 2: ReviseGPT (Medical AI) -->
                    <div class="project-slide" data-index="1">
                        <div class="project-content">
                            <h2 class="project-title" data-i18n="projects.project2.title">ReviseGPT</h2>
                            <p class="project-description" data-i18n="projects.project2.description">
                                An intelligent platform empowering medical students and professors with AI-driven diagnostics, adaptive quizzes, and automated course corrections â€” paired with a powerful admin dashboard for content oversight.
                            </p>
                            <div class="project-tags">
                                <span class="project-tag">Figma</span>
                                <span class="project-tag">UI/UX Design</span>
                            </div>

                            <!-- Case Study with Toggle -->
                            <div class="project-gallery">
                                <div class="gallery-toggle">
                                    <button class="gallery-toggle-btn active" data-view="user" data-project="2">
                                        <i data-lucide="smartphone" stroke-width="1.5"></i>
                                        <span data-i18n="projects.project2.userApp">User App</span>
                                    </button>
                                    <button class="gallery-toggle-btn" data-view="admin" data-project="2">
                                        <i data-lucide="layout-dashboard" stroke-width="1.5"></i>
                                        <span data-i18n="projects.project2.adminApp">Admin App</span>
                                    </button>
                                </div>

                                <!-- Case Study Container -->
                                <div class="case-study-container" id="case-study-project2">
                                    <!-- User App Case Study -->
                                    <div class="case-study-content active" id="case-study-user">
                                        <div class="case-study-scroll" id="user-scroll">
                                            <!-- Intro Panel -->
                                            <div class="case-study-intro">
                                                <div class="case-study-badge">
                                                    <span class="pulse-dot"></span>
                                                    <span data-i18n="projects.project2.caseStudy.badge">Case Study</span>
                                                </div>
                                                <h3 data-i18n="projects.project2.caseStudy.intro.title">ReviseGPT</h3>
                                                <p data-i18n="projects.project2.caseStudy.intro.description">An AI-powered medical education platform designed to support students through intelligent diagnostics, adaptive learning, and course correction.</p>
                                            </div>

                                            <!-- Feature 01: AI Diagnostic Chat -->
                                            <div class="case-study-panel">
                                                <div class="case-study-panel-header">
                                                    <div class="case-study-panel-label">
                                                        <span class="dot"></span>
                                                        <span data-i18n="projects.project2.caseStudy.features.feature01.label">Feature 01</span>
                                                    </div>
                                                    <h4 class="case-study-panel-title" data-i18n="projects.project2.caseStudy.features.feature01.title">AI Diagnostic Chat</h4>
                                                    <p class="case-study-panel-desc" data-i18n="projects.project2.caseStudy.features.feature01.description">Natural language processing enables students to ask medical questions and receive instant, accurate diagnostic guidance with cited medical sources.</p>
                                                </div>
                                                <div class="case-study-mockups">
                                                    <div class="case-study-mockup mockup-primary">
                                                        <img src="/medicalChatBot/app-user/chat-dark-mode.png" alt="AI Chat Interface" loading="lazy">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Feature 02: Adaptive Quiz System -->
                                            <div class="case-study-panel">
                                                <div class="case-study-panel-header">
                                                    <div class="case-study-panel-label">
                                                        <span class="dot"></span>
                                                        <span data-i18n="projects.project2.caseStudy.features.feature02.label">Feature 02</span>
                                                    </div>
                                                    <h4 class="case-study-panel-title" data-i18n="projects.project2.caseStudy.features.feature02.title">Adaptive Quiz System</h4>
                                                    <p class="case-study-panel-desc" data-i18n="projects.project2.caseStudy.features.feature02.description">AI-generated quizzes adapt to student performance and learning patterns. Questions reinforce weak areas and build comprehensive medical knowledge.</p>
                                                </div>
                                                <div class="case-study-mockups">
                                                    <div class="case-study-mockup mockup-primary">
                                                        <img src="/medicalChatBot/app-user/main page - quiz.png" alt="Quiz Interface" loading="lazy">
                                                    </div>
                                                    <div class="case-study-mockup mockup-secondary">
                                                        <img src="/medicalChatBot/app-user/main page - quiz-1.png" alt="Quiz Question View" loading="lazy">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Feature 03: PDF Course Correction -->
                                            <div class="case-study-panel">
                                                <div class="case-study-panel-header">
                                                    <div class="case-study-panel-label">
                                                        <span class="dot"></span>
                                                        <span data-i18n="projects.project2.caseStudy.features.feature03.label">Feature 03</span>
                                                    </div>
                                                    <h4 class="case-study-panel-title" data-i18n="projects.project2.caseStudy.features.feature03.title">PDF Course Correction</h4>
                                                    <p class="case-study-panel-desc" data-i18n="projects.project2.caseStudy.features.feature03.description">Upload medical textbooks or study materials to receive AI-powered corrections and annotations. The system identifies outdated information and provides current medical guidelines.</p>
                                                </div>
                                                <div class="case-study-mockups">
                                                    <div class="case-study-mockup mockup-primary">
                                                        <img src="/medicalChatBot/app-user/main page - correction.png" alt="Course Correction Upload" loading="lazy">
                                                    </div>
                                                    <div class="case-study-mockup mockup-secondary">
                                                        <img src="/medicalChatBot/app-user/main page - correction-1.png" alt="Correction Processing" loading="lazy">
                                                    </div>
                                                    <div class="case-study-mockup mockup-tertiary">
                                                        <img src="/medicalChatBot/app-user/main page - correction-2.png" alt="Correction Results" loading="lazy">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Feature 04: Profile & Access -->
                                            <div class="case-study-panel">
                                                <div class="case-study-panel-header">
                                                    <div class="case-study-panel-label">
                                                        <span class="dot"></span>
                                                        <span data-i18n="projects.project2.caseStudy.features.feature04.label">Feature 04</span>
                                                    </div>
                                                    <h4 class="case-study-panel-title" data-i18n="projects.project2.caseStudy.features.feature04.title">Profile & Access</h4>
                                                    <p class="case-study-panel-desc" data-i18n="projects.project2.caseStudy.features.feature04.description">Personalized student profiles with subscription management and premium features tailored for medical education.</p>
                                                </div>
                                                <div class="case-study-mockups">
                                                    <div class="case-study-mockup mockup-primary">
                                                        <img src="/medicalChatBot/app-user/profilePage1.png" alt="Student Profile Overview" loading="lazy">
                                                    </div>
                                                    <div class="case-study-mockup mockup-secondary">
                                                        <img src="/medicalChatBot/app-user/profilePage2.png" alt="Profile Settings" loading="lazy">
                                                    </div>
                                                    <div class="case-study-mockup mockup-tertiary">
                                                        <img src="/medicalChatBot/app-user/access plan.png" alt="Access Plans" loading="lazy">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Feature 05: Light & Dark Mode -->
                                            <div class="case-study-panel">
                                                <div class="case-study-panel-header">
                                                    <div class="case-study-panel-label">
                                                        <span class="dot"></span>
                                                        <span data-i18n="projects.project2.caseStudy.features.feature05.label">Design System</span>
                                                    </div>
                                                    <h4 class="case-study-panel-title" data-i18n="projects.project2.caseStudy.features.feature05.title">Light & Dark Mode</h4>
                                                    <p class="case-study-panel-desc" data-i18n="projects.project2.caseStudy.features.feature05.description">A carefully designed theme system optimized for extended study sessions. Dark mode reduces eye strain during night studying, while light mode ensures clarity in clinical settings.</p>
                                                </div>
                                                <div class="case-study-mockups">
                                                    <div class="case-study-mockup mockup-primary">
                                                        <img src="/medicalChatBot/app-user/chat-light-mode.png" alt="Light Mode Interface" loading="lazy">
                                                    </div>
                                                    <div class="case-study-mockup mockup-secondary">
                                                        <img src="/medicalChatBot/app-user/chat-dark-mode.png" alt="Dark Mode Interface" loading="lazy">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Navigation Arrows -->
                                        <button class="case-study-nav prev" data-scroll="user-scroll">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M15 18l-6-6 6-6"/></svg>
                                        </button>
                                        <button class="case-study-nav next" data-scroll="user-scroll">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M9 18l6-6-6-6"/></svg>
                                        </button>

                                        <!-- Progress Dots -->
                                        <div class="case-study-progress" data-scroll="user-scroll">
                                            <button class="case-study-dot active" data-index="0"></button>
                                            <button class="case-study-dot" data-index="1"></button>
                                            <button class="case-study-dot" data-index="2"></button>
                                            <button class="case-study-dot" data-index="3"></button>
                                            <button class="case-study-dot" data-index="4"></button>
                                            <button class="case-study-dot" data-index="5"></button>
                                        </div>
                                    </div>

                                    <!-- Admin App Case Study (hidden by default) -->
                                    <div class="case-study-content" id="case-study-admin">
                                        <div class="case-study-scroll" id="admin-scroll">
                                            <!-- Intro Panel -->
                                            <div class="case-study-intro">
                                                <div class="case-study-badge">
                                                    <span class="pulse-dot"></span>
                                                    <span data-i18n="projects.project2.caseStudy.badge">Case Study</span>
                                                </div>
                                                <h3 data-i18n="projects.project2.caseStudy.adminIntro.title">Admin Dashboard</h3>
                                                <p data-i18n="projects.project2.caseStudy.adminIntro.description">Comprehensive admin platform for managing medical education content, monitoring student progress, and overseeing course corrections.</p>
                                            </div>

                                            <!-- Feature 01: Admin Dashboard -->
                                            <div class="case-study-panel">
                                                <div class="case-study-panel-header">
                                                    <div class="case-study-panel-label">
                                                        <span class="dot"></span>
                                                        <span data-i18n="projects.project2.caseStudy.features.adminFeature01.label">Feature 01</span>
                                                    </div>
                                                    <h4 class="case-study-panel-title" data-i18n="projects.project2.caseStudy.features.adminFeature01.title">Admin Dashboard</h4>
                                                    <p class="case-study-panel-desc" data-i18n="projects.project2.caseStudy.features.adminFeature01.description">Centralized command center with real-time analytics, student activity monitoring, and platform health metrics.</p>
                                                </div>
                                                <div class="case-study-mockups">
                                                    <div class="case-study-mockup mockup-desktop">
                                                        <img src="/medicalChatBot/app-admin/dashboardLightMode.png" alt="Admin Dashboard Light Mode" loading="lazy">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Dashboard Dark Mode -->
                                            <div class="case-study-panel">
                                                <div class="case-study-panel-header">
                                                    <div class="case-study-panel-label">
                                                        <span class="dot"></span>
                                                        <span>Feature 01</span>
                                                    </div>
                                                </div>
                                                <div class="case-study-mockups">
                                                    <div class="case-study-mockup mockup-desktop">
                                                        <img src="/medicalChatBot/app-admin/dashboardDarkMode.png" alt="Admin Dashboard Dark Mode" loading="lazy">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Feature 02: User Management -->
                                            <div class="case-study-panel">
                                                <div class="case-study-panel-header">
                                                    <div class="case-study-panel-label">
                                                        <span class="dot"></span>
                                                        <span data-i18n="projects.project2.caseStudy.features.adminFeature02.label">Feature 02</span>
                                                    </div>
                                                    <h4 class="case-study-panel-title" data-i18n="projects.project2.caseStudy.features.adminFeature02.title">User Management</h4>
                                                    <p class="case-study-panel-desc" data-i18n="projects.project2.caseStudy.features.adminFeature02.description">Complete oversight of student and educator accounts. View detailed user profiles, edit permissions, and monitor individual learning progress.</p>
                                                </div>
                                                <div class="case-study-mockups">
                                                    <div class="case-study-mockup mockup-desktop">
                                                        <img src="/medicalChatBot/app-admin/usersPage.png" alt="Users Management Page" loading="lazy">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- User Details -->
                                            <div class="case-study-panel">
                                                <div class="case-study-panel-header">
                                                    <div class="case-study-panel-label">
                                                        <span class="dot"></span>
                                                        <span>Feature 02</span>
                                                    </div>
                                                </div>
                                                <div class="case-study-mockups">
                                                    <div class="case-study-mockup mockup-desktop">
                                                        <img src="/medicalChatBot/app-admin/usersDetailsModal.png" alt="User Details Modal" loading="lazy">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Edit User -->
                                            <div class="case-study-panel">
                                                <div class="case-study-panel-header">
                                                    <div class="case-study-panel-label">
                                                        <span class="dot"></span>
                                                        <span>Feature 02</span>
                                                    </div>
                                                </div>
                                                <div class="case-study-mockups">
                                                    <div class="case-study-mockup mockup-desktop">
                                                        <img src="/medicalChatBot/app-admin/editUserModal.png" alt="Edit User Modal" loading="lazy">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Feature 03: Quiz Analytics -->
                                            <div class="case-study-panel">
                                                <div class="case-study-panel-header">
                                                    <div class="case-study-panel-label">
                                                        <span class="dot"></span>
                                                        <span data-i18n="projects.project2.caseStudy.features.adminFeature03.label">Feature 03</span>
                                                    </div>
                                                    <h4 class="case-study-panel-title" data-i18n="projects.project2.caseStudy.features.adminFeature03.title">Quiz Analytics</h4>
                                                    <p class="case-study-panel-desc" data-i18n="projects.project2.caseStudy.features.adminFeature03.description">Deep insights into student performance and quiz effectiveness. Track completion rates, difficulty patterns, and learning outcomes.</p>
                                                </div>
                                                <div class="case-study-mockups">
                                                    <div class="case-study-mockup mockup-desktop">
                                                        <img src="/medicalChatBot/app-admin/quizAnalyticsPage.png" alt="Quiz Analytics Overview" loading="lazy">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Quiz Analytics Detail -->
                                            <div class="case-study-panel">
                                                <div class="case-study-panel-header">
                                                    <div class="case-study-panel-label">
                                                        <span class="dot"></span>
                                                        <span>Feature 03</span>
                                                    </div>
                                                </div>
                                                <div class="case-study-mockups">
                                                    <div class="case-study-mockup mockup-desktop">
                                                        <img src="/medicalChatBot/app-admin/quizAnalyticsPage2.png" alt="Quiz Analytics Detail" loading="lazy">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Feature 04: Course Correction Review -->
                                            <div class="case-study-panel">
                                                <div class="case-study-panel-header">
                                                    <div class="case-study-panel-label">
                                                        <span class="dot"></span>
                                                        <span data-i18n="projects.project2.caseStudy.features.adminFeature04.label">Feature 04</span>
                                                    </div>
                                                    <h4 class="case-study-panel-title" data-i18n="projects.project2.caseStudy.features.adminFeature04.title">Course Correction Review</h4>
                                                    <p class="case-study-panel-desc" data-i18n="projects.project2.caseStudy.features.adminFeature04.description">Review, approve, and manage AI-generated course corrections. Examine detailed correction reports and validate suggested updates.</p>
                                                </div>
                                                <div class="case-study-mockups">
                                                    <div class="case-study-mockup mockup-desktop">
                                                        <img src="/medicalChatBot/app-admin/correctionsPage.png" alt="Corrections Management" loading="lazy">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Correction Details -->
                                            <div class="case-study-panel">
                                                <div class="case-study-panel-header">
                                                    <div class="case-study-panel-label">
                                                        <span class="dot"></span>
                                                        <span>Feature 04</span>
                                                    </div>
                                                </div>
                                                <div class="case-study-mockups">
                                                    <div class="case-study-mockup mockup-desktop">
                                                        <img src="/medicalChatBot/app-admin/correctionDetailsModal.png" alt="Correction Details" loading="lazy">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Review Correction -->
                                            <div class="case-study-panel">
                                                <div class="case-study-panel-header">
                                                    <div class="case-study-panel-label">
                                                        <span class="dot"></span>
                                                        <span>Feature 04</span>
                                                    </div>
                                                </div>
                                                <div class="case-study-mockups">
                                                    <div class="case-study-mockup mockup-desktop">
                                                        <img src="/medicalChatBot/app-admin/reviewCorrectionModal.png" alt="Review Correction Modal" loading="lazy">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Feature 05: Payment Management -->
                                            <div class="case-study-panel">
                                                <div class="case-study-panel-header">
                                                    <div class="case-study-panel-label">
                                                        <span class="dot"></span>
                                                        <span data-i18n="projects.project2.caseStudy.features.adminFeature05.label">Feature 05</span>
                                                    </div>
                                                    <h4 class="case-study-panel-title" data-i18n="projects.project2.caseStudy.features.adminFeature05.title">Payment Management</h4>
                                                    <p class="case-study-panel-desc" data-i18n="projects.project2.caseStudy.features.adminFeature05.description">Monitor subscription revenue, track transactions, and manage payment operations with detailed financial reporting.</p>
                                                </div>
                                                <div class="case-study-mockups">
                                                    <div class="case-study-mockup mockup-desktop">
                                                        <img src="/medicalChatBot/app-admin/payementsManegementPage.png" alt="Payments Management" loading="lazy">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Transaction Details -->
                                            <div class="case-study-panel">
                                                <div class="case-study-panel-header">
                                                    <div class="case-study-panel-label">
                                                        <span class="dot"></span>
                                                        <span>Feature 05</span>
                                                    </div>
                                                </div>
                                                <div class="case-study-mockups">
                                                    <div class="case-study-mockup mockup-desktop">
                                                        <img src="/medicalChatBot/app-admin/transactionDetailsModal.png" alt="Transaction Details" loading="lazy">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Feature 06: Settings & Security -->
                                            <div class="case-study-panel">
                                                <div class="case-study-panel-header">
                                                    <div class="case-study-panel-label">
                                                        <span class="dot"></span>
                                                        <span data-i18n="projects.project2.caseStudy.features.adminFeature06.label">Feature 06</span>
                                                    </div>
                                                    <h4 class="case-study-panel-title" data-i18n="projects.project2.caseStudy.features.adminFeature06.title">Settings & Security</h4>
                                                    <p class="case-study-panel-desc" data-i18n="projects.project2.caseStudy.features.adminFeature06.description">Platform configuration and security controls. Manage system settings, configure AI parameters, and maintain security.</p>
                                                </div>
                                                <div class="case-study-mockups">
                                                    <div class="case-study-mockup mockup-desktop">
                                                        <img src="/medicalChatBot/app-admin/settingsPage.png" alt="Settings Configuration" loading="lazy">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Settings Advanced -->
                                            <div class="case-study-panel">
                                                <div class="case-study-panel-header">
                                                    <div class="case-study-panel-label">
                                                        <span class="dot"></span>
                                                        <span>Feature 06</span>
                                                    </div>
                                                </div>
                                                <div class="case-study-mockups">
                                                    <div class="case-study-mockup mockup-desktop">
                                                        <img src="/medicalChatBot/app-admin/settingsPage2.png" alt="Settings Advanced" loading="lazy">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Change Password -->
                                            <div class="case-study-panel">
                                                <div class="case-study-panel-header">
                                                    <div class="case-study-panel-label">
                                                        <span class="dot"></span>
                                                        <span>Feature 06</span>
                                                    </div>
                                                </div>
                                                <div class="case-study-mockups">
                                                    <div class="case-study-mockup mockup-desktop">
                                                        <img src="/medicalChatBot/app-admin/changePasswordModal.png" alt="Change Password" loading="lazy">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Navigation Arrows -->
                                        <button class="case-study-nav prev" data-scroll="admin-scroll">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M15 18l-6-6 6-6"/></svg>
                                        </button>
                                        <button class="case-study-nav next" data-scroll="admin-scroll">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M9 18l6-6-6-6"/></svg>
                                        </button>

                                        <!-- Progress Dots -->
                                        <div class="case-study-progress" data-scroll="admin-scroll">
                                            <button class="case-study-dot active" data-index="0"></button>
                                            <button class="case-study-dot" data-index="1"></button>
                                            <button class="case-study-dot" data-index="2"></button>
                                            <button class="case-study-dot" data-index="3"></button>
                                            <button class="case-study-dot" data-index="4"></button>
                                            <button class="case-study-dot" data-index="5"></button>
                                            <button class="case-study-dot" data-index="6"></button>
                                            <button class="case-study-dot" data-index="7"></button>
                                            <button class="case-study-dot" data-index="8"></button>
                                            <button class="case-study-dot" data-index="9"></button>
                                            <button class="case-study-dot" data-index="10"></button>
                                            <button class="case-study-dot" data-index="11"></button>
                                            <button class="case-study-dot" data-index="12"></button>
                                            <button class="case-study-dot" data-index="13"></button>
                                            <button class="case-study-dot" data-index="14"></button>
                                            <button class="case-study-dot" data-index="15"></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Project 3: Bookstore -->
                    <div class="project-slide" data-index="2">
                        <div class="project-content">
                            <h2 class="project-title" data-i18n="projects.project3.title">Esprit Livre</h2>
                            <p class="project-description" data-i18n="projects.project3.description">
                                A full-featured book e-commerce platform with a dedicated User app for browsing and purchasing, and a powerful Admin app giving the store owner complete control over products, orders, and content. The project emphasizes usability, motion-driven feedback, and scalable UI architecture.
                            </p>
                            <div class="project-tags">
                                <span class="project-tag">React</span>
                                <span class="project-tag">Tailwind CSS</span>
                                <span class="project-tag">TanStack Query</span>
                                <span class="project-tag">Framer Motion</span>
                                <span class="project-tag">Spring Boot</span>
                            </div>

                            <!-- User/Admin Toggle for Project 3 -->
                            <div class="project-gallery">
                                <div class="gallery-toggle">
                                    <button class="gallery-toggle-btn active" data-view="user" data-project="3">
                                        <i data-lucide="shopping-bag" stroke-width="1.5"></i>
                                        <span data-i18n="projects.project3.userApp">User App</span>
                                    </button>
                                    <button class="gallery-toggle-btn" data-view="admin" data-project="3">
                                        <i data-lucide="layout-dashboard" stroke-width="1.5"></i>
                                        <span data-i18n="projects.project3.adminApp">Admin App</span>
                                    </button>
                                </div>

                                <!-- User App View - Live Demo Button -->
                                <div id="project3-user-view" style="margin-top: 1.5rem;">
                                    <a href="#" class="project-link" target="_blank" rel="noopener">
                                        <span data-i18n="projects.project3.viewDemo">View Live Demo</span>
                                        <i data-lucide="arrow-right" stroke-width="1.5"></i>
                                    </a>
                                </div>

                                <!-- Admin App View - Video Preview (hidden by default) -->
                                <div id="project3-admin-view" style="display: none;">
                                    <div class="project-video-container">
                                        <div class="video-placeholder">
                                            <i data-lucide="play-circle" stroke-width="1"></i>
                                            <span data-i18n="projects.project3.videoPlaceholder">Demo Video Coming Soon</span>
                                        </div>
                                        <!-- Replace placeholder with actual video when ready:
                                        <video controls poster="/path/to/poster.jpg">
                                            <source src="/path/to/demo-video.mp4" type="video/mp4">
                                        </video>
                                        -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="section-container" id="section-about">
        <div class="section-content" style="max-width: 800px;">
            <h2 data-i18n="about.title">About</h2>
            <p style="margin-bottom: 1.5rem;" data-i18n="about.intro">UI/UX designer & frontend developer crafting web experiences with soul, speed, and precision.</p>
            <p style="margin-bottom: 1.5rem; font-size: 0.95rem;" data-i18n="about.paragraph1">I design in Figma, build with React + TypeScript, style with Tailwind, and bring interfaces to life using Framer Motion â€” delivering production-ready products that perform flawlessly.</p>
            <p style="margin-bottom: 2rem; font-size: 0.95rem;" data-i18n="about.paragraph2">Final-year Computer Science student actively freelancing and shipping personal projects reaching thousands of users.</p>

            <!-- Info Grid -->
            <div class="about-info-grid" style="display: flex; justify-content: center; gap: 3rem; margin-top: 2.5rem; font-size: 0.7rem; letter-spacing: 0.15em; text-transform: uppercase;">
                <div style="text-align: center;">
                    <span style="color: #a1a1aa; display: block; margin-bottom: 0.5rem;" data-i18n="about.location.label">Location</span>
                    <span style="color: #18181b;" data-i18n="about.location.value">Algeria</span>
                </div>
                <div style="text-align: center;">
                    <span style="color: #a1a1aa; display: block; margin-bottom: 0.5rem;" data-i18n="about.age.label">Age</span>
                    <span style="color: #18181b;" data-i18n="about.age.value">23</span>
                </div>
                <div style="text-align: center;">
                    <span style="color: #a1a1aa; display: block; margin-bottom: 0.5rem;" data-i18n="about.status.label">Status</span>
                    <span style="color: #18181b;" data-i18n="about.status.value">Available</span>
                </div>
            </div>

            <p style="margin-top: 2.5rem; font-size: 0.85rem; color: #52525b; font-weight: 500;" data-i18n="about.cta">Let's build something exceptional together.</p>
        </div>
    </div>

    <div class="section-container" id="section-skills">
        <div class="skills-content">
            <!-- Row 1: 3 columns -->
            <div class="skills-grid">
                <div class="skill-category" tabindex="0">
                    <h3 class="skill-title" data-i18n="skills.coreStrengths.title">Core Strengths</h3>
                    <div class="skill-separator"></div>
                    <ul class="skill-list" data-i18n-list="skills.coreStrengths.items">
                        <li>Framer Motion</li>
                        <li>Performance Tuning</li>
                        <li>Micro-interactions</li>
                        <li>Responsive Design</li>
                    </ul>
                </div>
                <div class="skill-category" tabindex="0">
                    <h3 class="skill-title" data-i18n="skills.frontendStack.title">Frontend Stack</h3>
                    <div class="skill-separator"></div>
                    <ul class="skill-list" data-i18n-list="skills.frontendStack.items">
                        <li>React + TypeScript</li>
                        <li>Tailwind CSS</li>
                        <li>React Native</li>
                    </ul>
                </div>
                <div class="skill-category" tabindex="0">
                    <h3 class="skill-title" data-i18n="skills.motionAnimation.title">Motion & Animation</h3>
                    <div class="skill-separator"></div>
                    <ul class="skill-list" data-i18n-list="skills.motionAnimation.items">
                        <li>Framer Motion</li>
                        <li>GSAP + ScrollTrigger</li>
                        <li>Performant vanilla JS animations</li>
                        <li>CSS Motion</li>
                    </ul>
                </div>
            </div>
            <!-- Row 2: 2 columns centered -->
            <div class="skills-grid skills-grid-bottom">
                <div class="skill-category" tabindex="0">
                    <h3 class="skill-title" data-i18n="skills.designPrototyping.title">Design & Prototyping</h3>
                    <div class="skill-separator"></div>
                    <ul class="skill-list" data-i18n-list="skills.designPrototyping.items">
                        <li>Figma (wireframing, prototyping & collaboration)</li>
                        <li>Framer</li>
                        <li>Adobe Photoshop</li>
                    </ul>
                </div>
                <div class="skill-category" tabindex="0">
                    <h3 class="skill-title" data-i18n="skills.engineeringTools.title">Engineering Tools</h3>
                    <div class="skill-separator"></div>
                    <ul class="skill-list" data-i18n-list="skills.engineeringTools.items">
                        <li>Git version control workflows</li>
                        <li>Vercel . Netlify . Cloudflare Pages</li>
                        <li>Docker . Docker Compose</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Section (Two-step: Email â†’ Message) -->
    <div class="section-container" id="section-contact">
        <div class="section-content">
            <!-- Background preview text that fades in as user types -->
            <div class="contact-preview" id="contact-preview"></div>

            <!-- Step 1: Email Input View -->
            <div class="contact-step" id="contact-step-email">
                <h2 data-i18n="contact.title">Contact</h2>
                <p data-i18n="contact.intro">Open to collaboration on ambitious projects. Let's create something meaningful together.</p>

                <div class="contact-input-wrapper">
                    <input
                        type="email"
                        id="contact-email-input"
                        class="contact-input"
                        placeholder="your@email.com"
                        data-i18n-placeholder="contact.emailPlaceholder"
                        autocomplete="email"
                        autocapitalize="off"
                        spellcheck="false"
                    >
                    <div class="contact-hint" id="contact-hint-email" data-i18n="contact.emailHint">Press Enter to continue</div>
                </div>

                <button class="contact-next-btn" id="contact-next-btn">
                    <span data-i18n="contact.next">Next</span>
                    <i data-lucide="arrow-right" class="w-4 h-4"></i>
                </button>
            </div>

            <!-- Step 2: Message Input View -->
            <div class="contact-step" id="contact-step-message" style="display: none;">
                <!-- Email badge (clickable to edit) -->
                <div class="contact-email-badge" id="contact-email-badge">
                    <span id="contact-email-display"></span>
                    <button class="contact-email-edit" id="contact-email-edit" aria-label="Edit email">
                        <i data-lucide="pencil" class="w-3 h-3"></i>
                    </button>
                </div>

                <div class="contact-message-wrapper">
                    <textarea
                        id="contact-message-input"
                        class="contact-message-input"
                        placeholder="Your message..."
                        data-i18n-placeholder="contact.messagePlaceholder"
                        rows="1"
                    ></textarea>
                </div>

                <button class="contact-send-btn" id="contact-send-btn">
                    <span class="btn-text" data-i18n="contact.send">Send</span>
                    <span class="btn-loading-text" style="display: none;">Sending...</span>
                    <i data-lucide="arrow-right" class="w-4 h-4 btn-icon"></i>
                    <span class="btn-spinner"></span>
                </button>

                <div class="contact-error-message" id="contact-error-message"></div>
            </div>

            <!-- Step 3: Thank You View -->
            <div class="contact-step contact-thank-you" id="contact-step-thanks" style="display: none;">
                <div class="contact-thank-you-icon">
                    <i data-lucide="check" class="w-12 h-12"></i>
                </div>
                <h2 data-i18n="contact.thankYou.title">Thank You</h2>
                <p data-i18n="contact.thankYou.message">Your message has been received. I'll get back to you soon.</p>
                <button class="contact-reset-btn" id="contact-reset-btn" data-i18n="contact.thankYou.sendAnother">Send another message</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Issue #7 fix: Helper to only reinitialize Lucide icons when needed
        function refreshLucideIcons(container) {
            // Check if there are any unrendered icons (i elements with data-lucide attribute)
            const scope = container || document;
            const pendingIcons = scope.querySelectorAll('i[data-lucide]');
            if (pendingIcons.length > 0 && typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        // ============================================
        // INTERNATIONALIZATION (i18n) CONTROLLER
        // ============================================
        const I18nController = {
            currentLang: 'en',
            translations: {},
            isLoaded: false,

            async init() {
                // Load saved language preference
                const savedLang = localStorage.getItem('portfolio-lang') || 'en';

                // Load translations
                await this.loadTranslations('en');
                await this.loadTranslations('fr');

                this.isLoaded = true;

                // Set initial language
                this.setLanguage(savedLang, false);

                // Bind toggle buttons
                this.bindEvents();
            },

            async loadTranslations(lang) {
                try {
                    const response = await fetch(`${lang}.json`);
                    if (response.ok) {
                        this.translations[lang] = await response.json();
                    }
                } catch (error) {
                    console.warn(`Failed to load ${lang}.json:`, error);
                }
            },

            bindEvents() {
                const langToggle = document.getElementById('lang-toggle');
                if (!langToggle) return;

                langToggle.querySelectorAll('button').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const lang = btn.dataset.lang;
                        if (lang !== this.currentLang) {
                            this.setLanguage(lang, true);
                        }
                    });
                });
            },

            setLanguage(lang, animate = true) {
                if (!this.translations[lang]) return;

                this.currentLang = lang;
                localStorage.setItem('portfolio-lang', lang);

                // Update toggle buttons
                document.querySelectorAll('#lang-toggle button').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.lang === lang);
                });

                // Apply translations
                if (animate) {
                    this.applyTranslationsAnimated();
                } else {
                    this.applyTranslations();
                }

                // Dispatch event for other components to react
                document.dispatchEvent(new CustomEvent('languageChanged', { detail: { lang } }));
            },

            getNestedValue(obj, path) {
                return path.split('.').reduce((current, key) => {
                    return current && current[key] !== undefined ? current[key] : null;
                }, obj);
            },

            applyTranslations() {
                const translations = this.translations[this.currentLang];
                if (!translations) return;

                // Update all elements with data-i18n attribute
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    const value = this.getNestedValue(translations, key);
                    if (value) {
                        el.textContent = value;
                    }
                });

                // Update placeholder attributes
                document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                    const key = el.getAttribute('data-i18n-placeholder');
                    const value = this.getNestedValue(translations, key);
                    if (value) {
                        el.placeholder = value;
                    }
                });

                // Update list items (skills)
                document.querySelectorAll('[data-i18n-list]').forEach(ul => {
                    const key = ul.getAttribute('data-i18n-list');
                    const items = this.getNestedValue(translations, key);
                    if (items && Array.isArray(items)) {
                        const listItems = ul.querySelectorAll('li');
                        items.forEach((text, index) => {
                            if (listItems[index]) {
                                listItems[index].textContent = text;
                            }
                        });
                    }
                });
            },

            applyTranslationsAnimated() {
                const translations = this.translations[this.currentLang];
                if (!translations) return;

                // Elements to animate
                const elements = document.querySelectorAll('[data-i18n], [data-i18n-list] li');

                // Determine which elements should be visible based on current app state
                const heroLayer = document.getElementById('hero-layer');
                const navLayer = document.getElementById('nav-layer');
                const introCta = document.getElementById('intro-cta-overlay');
                const activeSection = StateManager.activeSection;

                // Apply translations with subtle fade
                elements.forEach(el => {
                    // Check if element should be animated based on current state
                    const isInHeroLayer = heroLayer && heroLayer.contains(el);
                    const isInNavLayer = navLayer && navLayer.contains(el);
                    const isIntroCta = el === introCta;
                    const isInActiveSection = activeSection &&
                        el.closest(`#section-${activeSection}`);

                    // Determine if element is currently visible and should animate
                    let shouldAnimate = true;
                    let targetOpacity = 1;

                    // In NAVIGATION or SECTION_OPEN state, hero layer elements should stay hidden
                    if (StateManager.current !== AppState.HERO) {
                        if (isInHeroLayer) {
                            // Don't animate hero elements - just update text silently
                            shouldAnimate = false;
                        }
                        if (isIntroCta) {
                            // Intro CTA should stay at its current opacity
                            shouldAnimate = false;
                        }
                    }

                    // In SECTION_OPEN state, zone labels should stay hidden
                    if (StateManager.current === AppState.SECTION_OPEN) {
                        if (isInNavLayer && el.classList.contains('zone-label')) {
                            shouldAnimate = false;
                        }
                    }

                    // In HERO state, nav layer elements should stay hidden
                    if (StateManager.current === AppState.HERO) {
                        if (isInNavLayer) {
                            shouldAnimate = false;
                        }
                    }

                    if (shouldAnimate) {
                        // Get current computed opacity to restore after animation
                        const computedStyle = window.getComputedStyle(el);
                        const currentOpacity = parseFloat(computedStyle.opacity);

                        // Only animate if element is currently visible
                        if (currentOpacity > 0) {
                            gsap.to(el, {
                                opacity: 0,
                                duration: 0.15,
                                ease: 'power2.in',
                                onComplete: () => {
                                    // Update content
                                    if (el.hasAttribute('data-i18n')) {
                                        const key = el.getAttribute('data-i18n');
                                        const value = this.getNestedValue(translations, key);
                                        if (value) {
                                            el.textContent = value;
                                        }
                                    }

                                    gsap.to(el, {
                                        opacity: currentOpacity,
                                        duration: 0.2,
                                        ease: 'power2.out'
                                    });
                                }
                            });
                        } else {
                            // Element not visible - just update text without animation
                            if (el.hasAttribute('data-i18n')) {
                                const key = el.getAttribute('data-i18n');
                                const value = this.getNestedValue(translations, key);
                                if (value) {
                                    el.textContent = value;
                                }
                            }
                        }
                    } else {
                        // Don't animate - just update the text content silently
                        if (el.hasAttribute('data-i18n')) {
                            const key = el.getAttribute('data-i18n');
                            const value = this.getNestedValue(translations, key);
                            if (value) {
                                el.textContent = value;
                            }
                        }
                    }
                });

                // Update placeholder attributes (no animation needed)
                document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                    const key = el.getAttribute('data-i18n-placeholder');
                    const value = this.getNestedValue(translations, key);
                    if (value) {
                        el.placeholder = value;
                    }
                });

                // Update list items
                document.querySelectorAll('[data-i18n-list]').forEach(ul => {
                    const key = ul.getAttribute('data-i18n-list');
                    const items = this.getNestedValue(translations, key);
                    if (items && Array.isArray(items)) {
                        const listItems = ul.querySelectorAll('li');
                        items.forEach((text, index) => {
                            if (listItems[index]) {
                                listItems[index].textContent = text;
                            }
                        });
                    }
                });
            },

            // Helper method to get current translation
            t(key) {
                return this.getNestedValue(this.translations[this.currentLang], key) || key;
            }
        };

        // ============================================
        // CONFIGURATION
        // ============================================
        const CONFIG = {
            // Hero text sampling
            textSampleGap: 3,
            particleSize: 1.0,
            mouseRadius: 60,

            // Hero state
            driftRadius: 1.2,
            driftSpeed: 0.015,
            dustSpeed: 2.5,
            dustFade: 0.012,

            // Navigation state
            navParticleCount: 600,
            zoneConcentration: 0.6,
            apertureParticleCount: 300,
            apertureDuration: 0.7,

            // Colors
            colors: {
                primary: '39, 39, 42',
                name: '39, 39, 42',
                role: '39, 39, 42'
            }
        };

        // Zone positions (normalized 0-1)
        const ZONE_POSITIONS = {
            'projects': { x: 0.35, y: 0.35 },   // Much closer to center, largest
            'skills': { x: 0.72, y: 0.25 },     // Top-right, shifted left
            'about': { x: 0.25, y: 0.75 },      // Bottom-left, slightly larger
            'contact': { x: 0.65, y: 0.65 }     // Much closer to center
        };

        // ============================================
        // STATE MANAGEMENT
        // ============================================
        const AppState = {
            HERO: 'hero',
            NAVIGATION: 'navigation',
            SECTION_OPEN: 'section_open'
        };

        const StateManager = {
            current: AppState.HERO,
            previous: null,
            activeSection: null,
            isTransitioning: false,
            _transitionTimeoutId: null,
            _transitionTimeoutMs: 10000, // Max transition time before force-unlock

            transition(newState, data = {}) {
                if (this.isTransitioning && !data.force) return;
                if (this.current === newState && !data.force) return;

                this.isTransitioning = true;
                this.previous = this.current;
                this.current = newState;

                // Clear any existing timeout from a previous transition
                if (this._transitionTimeoutId) {
                    clearTimeout(this._transitionTimeoutId);
                    this._transitionTimeoutId = null;
                }

                // Set a timeout fallback to unlock if callback chain fails
                this._transitionTimeoutId = setTimeout(() => {
                    if (this.isTransitioning) {
                        console.warn('StateManager: Transition timeout reached, force-unlocking isTransitioning');
                        this.isTransitioning = false;
                    }
                    this._transitionTimeoutId = null;
                }, this._transitionTimeoutMs);

                TransitionController.execute(this.previous, newState, data, () => {
                    // Clear timeout since transition completed normally
                    if (this._transitionTimeoutId) {
                        clearTimeout(this._transitionTimeoutId);
                        this._transitionTimeoutId = null;
                    }
                    this.isTransitioning = false;
                });
            },

            setActiveSection(sectionName) {
                this.activeSection = sectionName;
            },

            clearActiveSection() {
                this.activeSection = null;
            }
        };

        // ============================================
        // CANVAS SETUP
        // ============================================
        const particleCanvas = document.getElementById('particle-canvas');
        const particleCtx = particleCanvas.getContext('2d', { willReadFrequently: false });

        const apertureCanvas = document.getElementById('aperture-canvas');
        const apertureCtx = apertureCanvas.getContext('2d');

        let width, height;
        let mouse = { x: -9999, y: -9999 };
        let resizeTimer;

        // ============================================
        // UNIFIED PARTICLE CLASS
        // ============================================
        class UnifiedParticle {
            constructor() {
                this.x = 0;
                this.y = 0;
                this.targetX = 0;
                this.targetY = 0;
                this.originX = 0;
                this.originY = 0;
                this.vx = 0;
                this.vy = 0;
                this.size = 1;
                this.alpha = 1;
                this.baseAlpha = 0.3;
                this.color = CONFIG.colors.primary;
                this.mode = 'wander';
                this.zone = null;
                this.isTextParticle = false;
                this.formed = false;
                this.ease = 0.05;
                this.wanderAngle = Math.random() * Math.PI * 2;
                this.wanderSpeed = 0.1;
                this.driftPhase = Math.random() * Math.PI * 2;
                this.driftAngle = Math.random() * Math.PI * 2;
                this.driftAmount = 1;
                this.dustVx = 0;
                this.dustVy = 0;
                this.dustAcceleration = 0;
                this.activeVelocity = 0;
            }

            initWander() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.mode = 'wander';
                this.alpha = 0;  // Start with opacity 0 for all particles
                this.baseAlpha = Math.random() * 0.3 + 0.1;
                this.wanderAngle = Math.random() * Math.PI * 2;
                this.wanderSpeed = 0.08 + Math.random() * 0.12;
                this.size = Math.random() * CONFIG.particleSize + 0.3;
                this.isTextParticle = false;
            }

            initTextFormation(targetX, targetY, colorRGB) {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.targetX = targetX;
                this.targetY = targetY;
                this.originX = targetX;
                this.originY = targetY;
                this.color = colorRGB;
                this.mode = 'wander';
                this.alpha = 0;  // Start with opacity 0
                this.baseAlpha = 1;  // Target opacity
                this.size = Math.random() * 0.2 + CONFIG.particleSize;
                this.ease = Math.random() * 0.06 + 0.03;
                this.driftPhase = Math.random() * Math.PI * 2;
                this.driftAngle = Math.random() * Math.PI * 2;
                this.driftAmount = Math.random() * CONFIG.driftRadius;
                this.isTextParticle = true;
                this.formed = false;
                this.wanderAngle = Math.random() * Math.PI * 2;
                this.wanderSpeed = 0.3 + Math.random() * 0.5;

                const angle = Math.PI + (Math.random() - 0.5) * 0.8;
                const speed = Math.random() * CONFIG.dustSpeed + 0.5;
                this.dustVx = Math.cos(angle) * speed;
                this.dustVy = Math.sin(angle) * speed;
                this.dustAcceleration = 0.02 + Math.random() * 0.03;

                // Opacity animation properties
                this.fadeStartTime = null;
                this.fadeDelay = 0.1 + Math.random() * 0.2;  // Random short delay
                this.fadeDuration = 0.4 + Math.random() * 0.2;  // Fast fade-in duration
            }

            initZoneParticle(zoneName) {
                this.zone = zoneName;
                const pos = ZONE_POSITIONS[zoneName];

                if (Math.random() < CONFIG.zoneConcentration) {
                    const spread = 0.15;
                    this.x = (pos.x + (Math.random() - 0.5) * spread) * width;
                    this.y = (pos.y + (Math.random() - 0.5) * spread) * height;
                } else {
                    this.x = Math.random() * width;
                    this.y = Math.random() * height;
                }

                this.originX = this.x;
                this.originY = this.y;
                this.mode = 'concentrate';
                this.alpha = Math.random() * 0.5 + 0.2;
                this.baseAlpha = this.alpha;
                this.size = Math.random() * 1.2 + 0.5;
                this.isTextParticle = false;
                this.wanderAngle = Math.random() * Math.PI * 2;
                this.wanderSpeed = 0.1 + Math.random() * 0.15;
            }

            update(hoveredZone, now) {
                switch (this.mode) {
                    case 'wander':
                        this.updateWander();
                        break;
                    case 'form':
                        this.updateFormation(now);
                        break;
                    case 'dust':
                        if (this.alpha <= 0) break;
                        this.updateDust();
                        break;
                    case 'concentrate':
                        this.updateConcentrate(hoveredZone);
                        break;
                }
            }

            updateWander() {
                this.wanderAngle += (Math.random() - 0.5) * 0.1;
                this.x += Math.cos(this.wanderAngle) * this.wanderSpeed;
                this.y += Math.sin(this.wanderAngle) * this.wanderSpeed;

                if (this.x < 0) this.wanderAngle = 0;
                if (this.x > width) this.wanderAngle = Math.PI;
                if (this.y < 0) this.wanderAngle = Math.PI / 2;
                if (this.y > height) this.wanderAngle = -Math.PI / 2;

                // For non-text particles in wander mode, gradually increase opacity to base level
                if (!this.isTextParticle && this.alpha < this.baseAlpha) {
                    this.alpha = Math.min(this.alpha + 0.01, this.baseAlpha);
                }
            }

            updateFormation(now) {
                const dx = mouse.x - this.x;
                const dy = mouse.y - this.y;
                const distance = Math.hypot(dx, dy);

                let forceX = 0;
                let forceY = 0;

                if (distance < CONFIG.mouseRadius) {
                    const forceDirectionX = dx / distance;
                    const forceDirectionY = dy / distance;
                    const force = (CONFIG.mouseRadius - distance) / CONFIG.mouseRadius;
                    const strength = 4;
                    forceX = -forceDirectionX * force * strength;
                    forceY = -forceDirectionY * force * strength;
                }

                this.driftPhase += CONFIG.driftSpeed;
                const driftX = Math.cos(this.driftPhase + this.driftAngle) * this.driftAmount;
                const driftY = Math.sin(this.driftPhase + this.driftAngle) * this.driftAmount;

                const targetX = this.originX + forceX + driftX;
                const targetY = this.originY + forceY + driftY;

                this.x += (targetX - this.x) * this.ease;
                this.y += (targetY - this.y) * this.ease;

                const distToOrigin = Math.hypot(this.x - this.originX, this.y - this.originY);
                if (distToOrigin < 5) {
                    this.formed = true;
                }

                // Handle opacity animation
                if (this.fadeStartTime === null) {
                    this.fadeStartTime = now;
                }

                const elapsed = (now - this.fadeStartTime) / 1000; // Convert to seconds

                if (elapsed >= this.fadeDelay) {
                    // Calculate fade progress (0 to 1)
                    const fadeProgress = Math.min((elapsed - this.fadeDelay) / this.fadeDuration, 1);
                    // Apply easing to the fade (ease-out)
                    const easedProgress = 1 - Math.pow(1 - fadeProgress, 2);
                    this.alpha = this.baseAlpha * easedProgress;
                } else {
                    // Still in delay phase
                    this.alpha = 0;
                }
            }

            updateDust() {
                if (this.activeVelocity < 1.5) {
                    this.activeVelocity += this.dustAcceleration;
                }

                this.x += this.dustVx * this.activeVelocity;
                this.y += this.dustVy * this.activeVelocity;
                this.y += (Math.random() - 0.5) * 0.4 * this.activeVelocity;
                this.x -= Math.random() * 0.2;

                this.alpha -= CONFIG.dustFade;
            }

            updateConcentrate(hoveredZone) {
                this.wanderAngle += (Math.random() - 0.5) * 0.08;
                this.x += Math.cos(this.wanderAngle) * this.wanderSpeed;
                this.y += Math.sin(this.wanderAngle) * this.wanderSpeed;

                // Mouse repulsion
                const dx = mouse.x - this.x;
                const dy = mouse.y - this.y;
                const dist = Math.hypot(dx, dy);

                if (dist < CONFIG.mouseRadius) {
                    const force = (CONFIG.mouseRadius - dist) / CONFIG.mouseRadius;
                    this.x -= (dx / dist) * force * 2;
                    this.y -= (dy / dist) * force * 2;
                }

                // Hover attraction to zone
                if (hoveredZone && this.zone === hoveredZone) {
                    const pos = ZONE_POSITIONS[hoveredZone];
                    const targetX = pos.x * width;
                    const targetY = pos.y * height;
                    this.x += (targetX - this.x) * 0.01;
                    this.y += (targetY - this.y) * 0.01;
                    this.alpha = Math.min(this.baseAlpha * 1.5, 1);
                } else {
                    this.alpha = this.baseAlpha;
                }

                // Soft wrap
                if (this.x < 0) this.x = width;
                if (this.x > width) this.x = 0;
                if (this.y < 0) this.y = height;
                if (this.y > height) this.y = 0;
            }

            draw(ctx) {
                if (this.alpha <= 0) return;
                ctx.fillStyle = `rgba(${this.color}, ${this.alpha})`;
                ctx.fillRect(this.x, this.y, this.size, this.size);
            }
        }

        // ============================================
        // APERTURE PARTICLE CLASS
        // ============================================
        class ApertureParticle {
            constructor(angle) {
                this.baseAngle = angle;
                this.angle = angle;
                this.size = Math.random() * 2 + 1;
                this.alpha = Math.random() * 0.8 + 0.2;
                this.wobble = Math.random() * Math.PI * 2;
                this.wobbleSpeed = 0.02 + Math.random() * 0.03;
                this.wobbleAmount = 5 + Math.random() * 10;
                this.x = 0;
                this.y = 0;
            }

            update(centerX, centerY, currentRadius) {
                this.wobble += this.wobbleSpeed;
                const wobbleOffset = Math.sin(this.wobble) * this.wobbleAmount;
                const radius = currentRadius + wobbleOffset;
                this.angle = this.baseAngle + Math.sin(this.wobble * 0.5) * 0.05;
                this.x = centerX + Math.cos(this.angle) * radius;
                this.y = centerY + Math.sin(this.angle) * radius;
            }

            draw(ctx) {
                ctx.fillStyle = `rgba(${CONFIG.colors.primary}, ${this.alpha})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // ============================================
        // PARTICLE SYSTEM
        // ============================================
        const ParticleSystem = {
            particles: [],
            textParticles: [],
            zoneParticles: [],
            apertureParticles: [],
            explosionParticles: [],
            isForming: false,
            isDusting: false,
            isSolidified: false,
            formationCheckStartTime: null,
            pulseScale: 1.0,

            init() {
                this.particles = [];
                this.textParticles = [];
                this.zoneParticles = [];
                this.explosionParticles = [];
                this.isForming = false;
                this.isDusting = false;
                this.isSolidified = false;
                this.formationCheckStartTime = null;
                this.pulseScale = 1.0;
            },

            initHeroState() {
                this.init();

                const textSamplingCtx = document.createElement('canvas').getContext('2d', { willReadFrequently: true });
                textSamplingCtx.canvas.width = width;
                textSamplingCtx.canvas.height = height;

                const sampleElement = (id, colorRGB) => {
                    const el = document.getElementById(id);
                    if (!el) return;

                    const rect = el.getBoundingClientRect();
                    const style = window.getComputedStyle(el);

                    // Clear canvas before sampling
                    textSamplingCtx.clearRect(0, 0, width, height);

                    // Apply all text rendering properties to match DOM exactly
                    textSamplingCtx.font = `${style.fontWeight} ${style.fontSize} ${style.fontFamily}`;
                    textSamplingCtx.fillStyle = 'white';
                    textSamplingCtx.textBaseline = 'top';

                    // Apply letter spacing manually by drawing each character with spacing
                    const letterSpacing = parseFloat(style.letterSpacing) || 0;
                    const text = el.innerText;
                    const centerX = rect.left + rect.width / 2;

                    if (letterSpacing && letterSpacing !== 0) {
                        // Use LEFT alignment for manual character positioning
                        textSamplingCtx.textAlign = 'left';

                        // Calculate total width with letter spacing
                        let totalWidth = 0;
                        for (let i = 0; i < text.length; i++) {
                            totalWidth += textSamplingCtx.measureText(text[i]).width;
                            if (i < text.length - 1) totalWidth += letterSpacing;
                        }

                        // Draw each character with proper spacing (currentX is left edge)
                        let currentX = centerX - totalWidth / 2;
                        for (let i = 0; i < text.length; i++) {
                            textSamplingCtx.fillText(text[i], currentX, rect.top);
                            currentX += textSamplingCtx.measureText(text[i]).width + letterSpacing;
                        }
                    } else {
                        // Use CENTER alignment for single fillText call
                        textSamplingCtx.textAlign = 'center';
                        textSamplingCtx.fillText(text, centerX, rect.top);
                    }

                    const buffer = 20;
                    const scanLeft = Math.floor(Math.max(0, rect.left - buffer));
                    const scanTop = Math.floor(Math.max(0, rect.top - buffer));
                    const scanW = Math.ceil(rect.width + buffer * 2);
                    const scanH = Math.ceil(rect.height + buffer * 2);

                    const imgData = textSamplingCtx.getImageData(scanLeft, scanTop, scanW, scanH);
                    const data = imgData.data;
                    const gap = CONFIG.textSampleGap;

                    for (let y = 0; y < scanH; y += gap) {
                        for (let x = 0; x < scanW; x += gap) {
                            const index = (y * scanW + x) * 4 + 3;
                            if (data[index] > 128) {
                                const pX = scanLeft + x;
                                const pY = scanTop + y;
                                const particle = new UnifiedParticle();
                                particle.initTextFormation(pX, pY, colorRGB);
                                this.textParticles.push(particle);
                            }
                        }
                    }
                    textSamplingCtx.clearRect(0, 0, width, height);
                };

                sampleElement('text-name', CONFIG.colors.name);
                sampleElement('text-role', CONFIG.colors.role);

                // All particles start with opacity 0
                this.particles = [...this.textParticles];
            },

            initNavigationState() {
                this.init();

                const zones = Object.keys(ZONE_POSITIONS);
                for (let i = 0; i < CONFIG.navParticleCount; i++) {
                    const particle = new UnifiedParticle();
                    const zone = zones[i % zones.length];
                    particle.initZoneParticle(zone);
                    this.zoneParticles.push(particle);
                }

                // Initialize aperture particles
                this.apertureParticles = [];
                for (let i = 0; i < CONFIG.apertureParticleCount; i++) {
                    const angle = (i / CONFIG.apertureParticleCount) * Math.PI * 2;
                    this.apertureParticles.push(new ApertureParticle(angle));
                }

                this.particles = [...this.zoneParticles];
            },

            startTextFormation() {
                this.isForming = true;
                this.textParticles.forEach(p => {
                    p.mode = 'form';
                    // Reset opacity for the fade-in animation
                    p.alpha = 0;
                    p.fadeStartTime = null; // Reset to start the animation
                });
            },

            startDusting() {
                this.isDusting = true;
                this.textParticles.forEach(p => {
                    p.mode = 'dust';
                    p.activeVelocity = 0;
                });
            },

            checkFormationComplete() {
                if (this.isSolidified || !this.isForming) return false;

                // Count particles that are formed and visible
                let formedCount = 0;
                let totalCount = this.textParticles.length;

                this.textParticles.forEach(p => {
                    if (p.formed && p.alpha > p.baseAlpha * 0.8) {
                        formedCount++;
                    }
                });

                const formationPercentage = formedCount / totalCount;
                return formationPercentage >= 0.75; // 75% completion threshold
            },

            solidifyText() {
                if (this.isSolidified) return;
                this.isSolidified = true;

                const textName = document.getElementById('text-name');
                const textRole = document.getElementById('text-role');

                // Pulse animation for particles
                gsap.to(this, {
                    pulseScale: 1.05,
                    duration: 0.15,
                    ease: 'power2.out',
                    onComplete: () => {
                        gsap.to(this, {
                            pulseScale: 1.0,
                            duration: 0.2,
                            ease: 'power2.inOut'
                        });
                    }
                });

                // Fade in solid text, then reveal CTA
                gsap.to([textName, textRole], {
                    opacity: 1,
                    duration: 0.5,
                    ease: 'power2.inOut',
                    onComplete: () => {
                        const ctaBtn = document.getElementById('cta-btn');
                        gsap.fromTo(ctaBtn,
                            { opacity: 0, y: 10 },
                            {
                                opacity: 1,
                                y: 0,
                                duration: 0.6,
                                ease: 'power3.out',
                                onComplete: () => {
                                    ctaBtn.style.pointerEvents = 'auto';
                                }
                            }
                        );
                    }
                });

                // Smoothly fade out particles as text fades in
                gsap.to(this.textParticles, {
                    baseAlpha: 0,
                    duration: 0.5,
                    ease: 'power2.inOut',
                    onUpdate: () => {
                        // Smoothly reduce particle alpha
                        this.textParticles.forEach(p => {
                            p.alpha = p.baseAlpha;
                        });
                    }
                });
            },

            reverseSolidification(onComplete) {
                const textName = document.getElementById('text-name');
                const textRole = document.getElementById('text-role');

                // Fade out solid text (particles are already hidden)
                gsap.to([textName, textRole], {
                    opacity: 0,
                    duration: 0.5,
                    ease: 'power2.inOut',
                    onComplete: () => {
                        // Ensure text is completely hidden with inline style
                        textName.style.opacity = '0';
                        textRole.style.opacity = '0';
                        textName.style.filter = 'blur(0px)';
                        textRole.style.filter = 'blur(0px)';

                        // Reset for next time
                        this.isSolidified = false;

                        if (onComplete) onComplete();
                    }
                });
            },

            // Simple fadeout animation for text elements
            curtainWipeText(onComplete) {
                const textName = document.getElementById('text-name');
                const textRole = document.getElementById('text-role');

                // Fade out with blur effect
                gsap.to([textName, textRole], {
                    opacity: 0,
                    filter: 'blur(4px)',
                    duration: 0.6,
                    ease: 'power2.out',
                    onComplete: () => {
                        // Reset filter for next time
                        textName.style.filter = 'blur(0px)';
                        textRole.style.filter = 'blur(0px)';

                        // Reset for next time
                        this.isSolidified = false;

                        if (onComplete) onComplete();
                    }
                });
            },

            // Legacy function name for backward compatibility
            reverseTypewriter(onComplete) {
                this.curtainWipeText(onComplete);
            },

            createTextExplosion(text, x, y, fontSize) {
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d', { willReadFrequently: true });
                tempCanvas.width = width;
                tempCanvas.height = height;

                tempCtx.font = `500 ${fontSize}px Inter`;
                tempCtx.fillStyle = 'white';
                tempCtx.textAlign = 'center';
                tempCtx.textBaseline = 'middle';
                tempCtx.fillText(text, x, y);

                const imageData = tempCtx.getImageData(0, 0, width, height);
                const data = imageData.data;
                const gap = 4;

                for (let py = 0; py < height; py += gap) {
                    for (let px = 0; px < width; px += gap) {
                        const index = (py * width + px) * 4 + 3;
                        if (data[index] > 128) {
                            const particle = {
                                x: px,
                                y: py,
                                vx: (Math.random() - 0.5) * 12,
                                vy: (Math.random() - 0.5) * 12 - 2,
                                size: Math.random() * 2 + 1,
                                alpha: 1,
                                decay: 0.02 + Math.random() * 0.015,
                                color: CONFIG.colors.primary,

                                update() {
                                    this.x += this.vx;
                                    this.y += this.vy;
                                    this.vx *= 0.96;
                                    this.vy *= 0.96;
                                    this.vy += 0.08;
                                    this.alpha -= this.decay;
                                },

                                draw(ctx) {
                                    if (this.alpha <= 0) return;
                                    ctx.fillStyle = `rgba(${this.color}, ${this.alpha})`;
                                    ctx.fillRect(this.x, this.y, this.size, this.size);
                                }
                            };

                            this.explosionParticles.push(particle);
                        }
                    }
                }
            },

            update(hoveredZone, now) {
                this.particles.forEach(p => {
                    p.update(hoveredZone, now);
                });

                this.explosionParticles = this.explosionParticles.filter(p => p.alpha > 0);
                this.explosionParticles.forEach(p => p.update());

                // Check for formation completion
                if (this.isForming && !this.isSolidified) {
                    if (this.checkFormationComplete()) {
                        if (!this.formationCheckStartTime) {
                            this.formationCheckStartTime = now;
                        } else if (now - this.formationCheckStartTime >= 300) {
                            // 300ms = 0.3 seconds delay after formation complete
                            this.solidifyText();
                        }
                    }
                }
            },

            draw(ctx) {
                // Apply pulse scale if solidifying
                if (this.pulseScale !== 1.0 && this.isForming) {
                    const centerX = width / 2;
                    const centerY = height / 2;

                    ctx.save();
                    ctx.translate(centerX, centerY);
                    ctx.scale(this.pulseScale, this.pulseScale);
                    ctx.translate(-centerX, -centerY);

                    this.particles.forEach(p => p.draw(ctx));

                    ctx.restore();
                } else {
                    this.particles.forEach(p => p.draw(ctx));
                }

                this.explosionParticles.forEach(p => p.draw(ctx));
            },

            getActiveParticleCount() {
                let count = 0;
                for (let i = 0; i < this.particles.length; i++) {
                    if (this.particles[i].alpha > 0) count++;
                }
                return count;
            }
        };

        // ============================================
        // APERTURE SYSTEM
        // ============================================
        const ApertureSystem = {
            state: 0,
            center: { x: 0, y: 0 },
            isAnimating: false,
            activeZone: null,

            // Zone ring states for always-visible rings with size multipliers
            zoneRings: {
                'projects': { scale: 1, baseScale: 2.0, hoverScale: 1.8, opacity: 0, particles: [] },  // Largest, much bigger ring
                'skills': { scale: 1, baseScale: 0.9, hoverScale: 1.5, opacity: 0, particles: [] },    // Smaller
                'about': { scale: 1, baseScale: 1.15, hoverScale: 1.5, opacity: 0, particles: [] },    // Slightly larger
                'contact': { scale: 1, baseScale: 1.8, hoverScale: 1.75, opacity: 0, particles: [] }   // Bigger ring, closer to center
            },

            // Base radius for zone rings (responsive)
            getBaseRadius() {
                // Increase radius on mobile for better spacing between text and rings
                const isMobile = window.innerWidth <= 768;
                const basePercent = isMobile ? 0.09 : 0.06; // 9% on mobile, 6% on desktop
                return Math.min(width, height) * basePercent;
            },

            initZoneRings(animate = true) {
                const particlesPerRing = 60;
                const zones = Object.keys(this.zoneRings);

                zones.forEach((zone, index) => {
                    // Kill any existing GSAP tweens on this zone ring to prevent animation overlap
                    gsap.killTweensOf(this.zoneRings[zone]);
                    this.zoneRings[zone].particles = [];
                    this.zoneRings[zone].opacity = 0; // Reset opacity
                    this.zoneRings[zone].scale = 1; // Reset scale (prevents stale hover scale)
                    for (let i = 0; i < particlesPerRing; i++) {
                        const angle = (i / particlesPerRing) * Math.PI * 2;
                        this.zoneRings[zone].particles.push(new ApertureParticle(angle));
                    }

                    // Animate each ring fading in with stagger
                    if (animate) {
                        gsap.to(this.zoneRings[zone], {
                            opacity: 1,
                            duration: 0.8,
                            delay: 0.3 + (index * 0.1), // Staggered delay for each ring
                            ease: 'power2.out'
                        });
                    } else {
                        this.zoneRings[zone].opacity = 1;
                    }
                });
            },

            hideZoneRings(animate = true) {
                const zones = Object.keys(this.zoneRings);

                zones.forEach((zone, index) => {
                    // Kill any existing GSAP tweens on this zone ring to prevent animation overlap
                    gsap.killTweensOf(this.zoneRings[zone]);
                    if (animate) {
                        gsap.to(this.zoneRings[zone], {
                            opacity: 0,
                            duration: 0.3,
                            delay: index * 0.03,
                            ease: 'power2.in'
                        });
                    } else {
                        this.zoneRings[zone].opacity = 0;
                    }
                });
            },

            showZoneRings(animate = true) {
                const zones = Object.keys(this.zoneRings);

                zones.forEach((zone, index) => {
                    // Kill any existing GSAP tweens on this zone ring to prevent animation overlap
                    gsap.killTweensOf(this.zoneRings[zone]);
                    if (animate) {
                        gsap.to(this.zoneRings[zone], {
                            opacity: 1,
                            duration: 0.8,
                            delay: 0.3 + (index * 0.1), // Match initial page load timing
                            ease: 'power2.out'
                        });
                    } else {
                        this.zoneRings[zone].opacity = 1;
                    }
                });
            },

            setCenter(x, y) {
                this.center.x = x;
                this.center.y = y;
            },

            setHoveredZone(zoneName) {
                // Animate scale up for hovered zone using custom hoverScale
                if (zoneName) {
                    const ring = this.zoneRings[zoneName];
                    gsap.killTweensOf(ring, 'scale');
                    gsap.to(ring, {
                        scale: ring.hoverScale,
                        duration: 0.4,
                        ease: 'power2.out'
                    });
                }
            },

            clearHoveredZone(zoneName) {
                // Animate scale back down
                if (zoneName && this.zoneRings[zoneName]) {
                    gsap.killTweensOf(this.zoneRings[zoneName], 'scale');
                    gsap.to(this.zoneRings[zoneName], {
                        scale: 1,
                        duration: 0.3,
                        ease: 'power2.in'
                    });
                }
            },

            animateOpen(duration, onComplete) {
                this.isAnimating = true;
                gsap.to(this, {
                    state: 1,
                    duration: duration,
                    ease: 'power2.inOut',
                    onComplete: () => {
                        this.isAnimating = false;
                        if (onComplete) onComplete();
                    }
                });
            },

            animateClose(duration, onComplete) {
                this.isAnimating = true;
                gsap.to(this, {
                    state: 0,
                    duration: duration,
                    delay: 0.2,
                    ease: 'power2.inOut',
                    onComplete: () => {
                        this.isAnimating = false;
                        if (onComplete) onComplete();
                    }
                });
            },

            draw(ctx) {
                // Draw zone rings when in navigation state or while rings are still fading out
                const hasVisibleRings = Object.keys(this.zoneRings).some(z => this.zoneRings[z].opacity > 0);
                if (this.state < 1 && (StateManager.current !== AppState.HERO || hasVisibleRings)) {
                    this.drawZoneRings(ctx);
                }

                // Draw opening/closing aperture animation
                if (this.state > 0 && this.state < 1) {
                    const maxRadius = Math.max(width, height) * 1.5;
                    const currentRadius = maxRadius * this.state;

                    ctx.save();
                    ctx.fillStyle = '#fafafa';
                    ctx.beginPath();
                    ctx.rect(0, 0, width, height);
                    ctx.arc(this.center.x, this.center.y, currentRadius, 0, Math.PI * 2, true);
                    ctx.fill();

                    ParticleSystem.apertureParticles.forEach(p => {
                        p.update(this.center.x, this.center.y, currentRadius);
                        p.draw(ctx);
                    });

                    ctx.restore();
                }
            },

            drawZoneRings(ctx) {
                const baseRadius = this.getBaseRadius();

                Object.keys(ZONE_POSITIONS).forEach(zoneName => {
                    const pos = ZONE_POSITIONS[zoneName];
                    const centerX = pos.x * width;
                    const centerY = pos.y * height;
                    const ring = this.zoneRings[zoneName];
                    // Apply both baseScale (size hierarchy) and scale (hover animation)
                    const currentRadius = baseRadius * ring.baseScale * ring.scale;

                    // Skip drawing if ring is fully transparent
                    if (ring.opacity <= 0) return;

                    ring.particles.forEach(p => {
                        p.update(centerX, centerY, currentRadius);
                        // Draw with ring opacity applied
                        const originalAlpha = p.alpha;
                        p.alpha = originalAlpha * ring.opacity;
                        p.draw(ctx);
                        p.alpha = originalAlpha; // Restore original alpha
                    });
                });
            }
        };

        // ============================================
        // TRANSITION CONTROLLER
        // ============================================
        const TransitionController = {
            _heroToNavCheckDustInterval: null,

            clearPendingTransitions() {
                if (this._heroToNavCheckDustInterval) {
                    clearInterval(this._heroToNavCheckDustInterval);
                    this._heroToNavCheckDustInterval = null;
                }
                // Clear typewriter timeouts to prevent memory leaks and visual glitches
                if (this._typewriterTimeoutId) {
                    clearTimeout(this._typewriterTimeoutId);
                    this._typewriterTimeoutId = null;
                }
                if (this._typewriterHoldTimeoutId) {
                    clearTimeout(this._typewriterHoldTimeoutId);
                    this._typewriterHoldTimeoutId = null;
                }
            },

            // Kill all active GSAP tweens on transition elements to prevent animation conflicts
            killActiveTransitionTweens() {
                const navLayer = document.getElementById('nav-layer');
                const heroLayer = document.getElementById('hero-layer');
                const introCta = document.getElementById('intro-cta-overlay');
                const closeBtn = document.getElementById('close-btn');
                const closeBtnProjects = document.getElementById('close-btn-projects');
                const zoneLabels = document.querySelectorAll('.zone-label');
                const ctaBtn = document.getElementById('cta-btn');

                // Kill tweens on all commonly animated transition elements
                gsap.killTweensOf(navLayer);
                gsap.killTweensOf(heroLayer);
                gsap.killTweensOf(introCta);
                gsap.killTweensOf(closeBtn);
                gsap.killTweensOf(closeBtnProjects);
                gsap.killTweensOf(zoneLabels);
                gsap.killTweensOf(ctaBtn);
                gsap.killTweensOf('.zone-label');

                // Kill GSAP animations on ParticleSystem before particle arrays are replaced
                gsap.killTweensOf(ParticleSystem);
                ParticleSystem.textParticles.forEach(p => gsap.killTweensOf(p));
                ParticleSystem.zoneParticles.forEach(p => gsap.killTweensOf(p));
            },

            // Reset inline styles on transition elements to prevent state mismatch with CSS classes
            resetInlineStyles(elements) {
                const styleProps = ['opacity', 'filter', 'display', 'transform', 'pointerEvents'];
                elements.forEach(el => {
                    if (el) {
                        styleProps.forEach(prop => {
                            el.style[prop] = '';
                        });
                    }
                });
            },

            execute(fromState, toState, data, onComplete) {
                const transitionKey = `${fromState}_to_${toState}`;

                // Kill any ongoing animations on transition elements before starting new transition
                this.killActiveTransitionTweens();
                this.clearPendingTransitions();

                const transitions = {
                    'hero_to_navigation': this.heroToNavigation.bind(this),
                    'navigation_to_section_open': this.navigationToSection.bind(this),
                    'section_open_to_navigation': this.sectionToNavigation.bind(this),
                    'navigation_to_hero': this.navigationToHero.bind(this),
                    'section_open_to_hero': this.sectionToHero.bind(this)
                };

                const transitionFn = transitions[transitionKey];
                if (transitionFn) {
                    transitionFn(data, onComplete);
                } else {
                    onComplete();
                }
            },

            heroToNavigation(data, onComplete) {
                const heroLayer = document.getElementById('hero-layer');
                const navLayer = document.getElementById('nav-layer');
                const introCta = document.getElementById('intro-cta-overlay');

                // Issue #5 fix: Reset formationCheckStartTime when leaving hero
                ParticleSystem.formationCheckStartTime = null;

                // Clear any existing interval from a previous interrupted transition
                this.clearPendingTransitions();

                // Wait for dust animation to nearly complete before showing navigation
                this._heroToNavCheckDustInterval = setInterval(() => {
                    if (ParticleSystem.getActiveParticleCount() < ParticleSystem.textParticles.length * 0.1) { // When 90% of particles have scattered
                        clearInterval(this._heroToNavCheckDustInterval);
                        this._heroToNavCheckDustInterval = null;

                        navLayer.classList.add('visible');

                        // Phase 1: Typewriter effect for intro CTA
                        const fullText = introCta.getAttribute('data-i18n')
                            ? I18nController.t(introCta.getAttribute('data-i18n'))
                            : introCta.textContent;
                        introCta.textContent = '';
                        introCta.style.opacity = '1';
                        introCta.classList.add('typing');

                        let charIndex = 0;
                        const typeSpeed = 45; // ms per character

                        const self = this;
                        const typeNextChar = () => {
                            if (charIndex < fullText.length) {
                                introCta.textContent += fullText.charAt(charIndex);
                                charIndex++;
                                self._typewriterTimeoutId = setTimeout(typeNextChar, typeSpeed);
                            } else {
                                // Typing complete - hold briefly then fade out
                                self._typewriterTimeoutId = null;
                                self._typewriterHoldTimeoutId = setTimeout(() => {
                                    self._typewriterHoldTimeoutId = null;
                                    introCta.classList.remove('typing');
                                    gsap.to(introCta, {
                                        opacity: 0,
                                        duration: 0.5,
                                        ease: 'power2.in',
                                        onComplete: fadeOutComplete
                                    });
                                }, 800); // Hold after typing completes
                            }
                        };

                        // Start typing after a brief delay
                        this._typewriterTimeoutId = setTimeout(() => {
                            const typingSound = new Audio('sound/typing.wav');
                            typingSound.play();
                            typeNextChar();
                        }, 200);

                        // Phase 2: After fade out, show nav content
                        const fadeOutComplete = () => {
                                // Clear inline styles on introCta
                                self.resetInlineStyles([introCta]);

                                // Hide hero layer - keep display:none inline (CSS default is display:flex)
                                // Clear other inline styles (opacity, filter) to prevent state mismatch
                                heroLayer.style.display = 'none';
                                heroLayer.style.opacity = '';
                                heroLayer.style.filter = '';

                                // Phase 3: Now initialize and show the nav content
                                ParticleSystem.initNavigationState();
                                ApertureSystem.initZoneRings();

                                // Fade in nav layer with blur clearing
                                // Note: Keep inline styles - CSS defaults are opacity:0, filter:blur(12px)
                                gsap.to(navLayer, {
                                    opacity: 1,
                                    filter: 'blur(0px)',
                                    duration: 0.8,
                                    ease: 'power2.out',
                                    onComplete: onComplete
                                });

                                // Zone labels fade in with upward motion
                                // Note: Keep inline styles - CSS defaults are opacity:0, transform:translateY(8px)
                                gsap.to('.zone-label', {
                                    opacity: 1,
                                    y: 0,
                                    duration: 0.7,
                                    stagger: 0.12,
                                    delay: 0.1,
                                    ease: 'power3.out'
                                });
                        };
                    }
                }, 50);
            },

            navigationToSection(data, onComplete) {
                const { sectionName } = data;
                const section = document.getElementById(`section-${sectionName}`);
                const closeBtn = document.getElementById('close-btn');
                const closeBtnProjects = document.getElementById('close-btn-projects');
                const zones = document.querySelectorAll('.zone');
                const zoneLabels = document.querySelectorAll('.zone-label');
                const backBtn = document.getElementById('back-hero-btn');
                const pos = ZONE_POSITIONS[sectionName];

                section.classList.add('active');

                // Reset leftover inline styles from previous exit animations on content containers
                const contentEl = section.querySelector('.section-content') || section.querySelector('.skills-content');
                if (contentEl) {
                    contentEl.style.opacity = '';
                    contentEl.style.transform = '';
                }

                zones.forEach(z => z.style.pointerEvents = 'none');

                // Hide zone labels and rings when opening a section
                gsap.to(zoneLabels, {
                    opacity: 0,
                    y: -8,
                    duration: 0.3,
                    stagger: 0.05,
                    ease: 'power2.in'
                });
                ApertureSystem.hideZoneRings(true);
                backBtn.style.display = 'none';

                ApertureSystem.setCenter(pos.x * width, pos.y * height);
                ApertureSystem.animateOpen(CONFIG.apertureDuration, () => {
                    StateManager.setActiveSection(sectionName);
                    onComplete();
                });

                // Show appropriate close button based on section
                if (sectionName === 'projects') {
                    // Use projects-specific close button
                    gsap.to(closeBtnProjects, {
                        opacity: 1,
                        duration: 0.3,
                        delay: CONFIG.apertureDuration * 0.5,
                        onStart: () => closeBtnProjects.classList.add('visible'),
                        onComplete: () => {
                            closeBtnProjects.style.opacity = '';
                        }
                    });
                } else {
                    // Use main close button for other sections
                    gsap.to(closeBtn, {
                        opacity: 1,
                        duration: 0.3,
                        delay: CONFIG.apertureDuration * 0.5,
                        onStart: () => closeBtn.classList.add('visible'),
                        onComplete: () => {
                            closeBtn.style.opacity = '';
                        }
                    });
                }

                // Skills section has different structure - no .section-content
                if (sectionName === 'skills') {
                    const skillCategories = section.querySelectorAll('.skill-category');

                    gsap.fromTo(skillCategories,
                        { opacity: 0, y: 30 },
                        {
                            opacity: 1,
                            y: 0,
                            duration: 0.5,
                            stagger: 0.08,
                            delay: CONFIG.apertureDuration * 0.6,
                            ease: 'power3.out'
                        }
                    );
                } else if (sectionName === 'projects') {
                    // Projects section has custom carousel layout
                    ProjectsController.reset();
                    ProjectsController.animateIn();
                } else {
                    const content = section.querySelector('.section-content');
                    const h2 = content.querySelector('h2');
                    const p = content.querySelector('p');

                    // If about section, animate all paragraphs and info grid
                    if (sectionName === 'about') {
                        const allParagraphs = content.querySelectorAll('p');
                        const infoGrid = content.querySelector('.about-info-grid');

                        gsap.fromTo([h2, ...allParagraphs, infoGrid],
                            { opacity: 0, y: 30 },
                            {
                                opacity: 1,
                                y: 0,
                                duration: 0.6,
                                stagger: 0.15,
                                delay: CONFIG.apertureDuration * 0.6,
                                ease: 'power3.out'
                            }
                        );
                    } else if (sectionName === 'contact') {
                        const contactElements = content.querySelectorAll('.contact-input, .contact-hint, .contact-email-badge, .contact-message-input, .contact-send-btn, .contact-thank-you-icon, .contact-reset-btn, .contact-next-btn');
                        gsap.fromTo([h2, p, ...contactElements],
                            { opacity: 0, y: 30 },
                            {
                                opacity: 1,
                                y: 0,
                                duration: 0.6,
                                stagger: 0.15,
                                delay: CONFIG.apertureDuration * 0.6,
                                ease: 'power3.out'
                            }
                        );
                    } else {
                        gsap.fromTo([h2, p],
                            { opacity: 0, y: 30 },
                            {
                                opacity: 1,
                                y: 0,
                                duration: 0.6,
                                stagger: 0.15,
                                delay: CONFIG.apertureDuration * 0.6,
                                ease: 'power3.out'
                            }
                        );
                    }
                }

                // If contact section, animate the form and focus input
                if (sectionName === 'contact') {
                    const contactStep = section.querySelector('.contact-step');
                    gsap.fromTo(contactStep,
                        { opacity: 0, y: 20 },
                        {
                            opacity: 1,
                            y: 0,
                            duration: 0.5,
                            delay: CONFIG.apertureDuration * 0.8,
                            ease: 'power2.out',
                            onComplete: () => {
                                ContactController.focusInput();
                            }
                        }
                    );
                }
            },

            sectionToNavigation(data, onComplete) {
                const sectionName = StateManager.activeSection;
                const section = document.getElementById(`section-${sectionName}`);
                const closeBtn = document.getElementById('close-btn');
                const closeBtnProjects = document.getElementById('close-btn-projects');
                const zones = document.querySelectorAll('.zone');
                const zoneLabels = document.querySelectorAll('.zone-label');
                const backBtn = document.getElementById('back-hero-btn');

                // Shared aperture close + cleanup
                const closeAperture = () => {
                    ApertureSystem.animateClose(CONFIG.apertureDuration, () => {
                        if (sectionName === 'contact') {
                            ContactController.reset();
                        }
                        if (sectionName === 'skills') {
                            SkillsController.reset();
                        }

                        section.classList.remove('active');
                        zones.forEach(z => z.style.pointerEvents = 'auto');
                        backBtn.style.display = 'block';
                        StateManager.clearActiveSection();

                        // Reinitialize zone rings (don't animate yet - we'll animate with showZoneRings)
                        ApertureSystem.initZoneRings(false);
                        // Reset ring opacities to 0 for the fade-in animation
                        Object.keys(ApertureSystem.zoneRings).forEach(zone => {
                            ApertureSystem.zoneRings[zone].opacity = 0;
                        });

                        // Show zone rings and labels together with matching timing (like initial page load)
                        ApertureSystem.showZoneRings(true);

                        // Show zone labels with same timing as rings
                        // Note: Keep inline styles - CSS defaults are opacity:0, transform:translateY(8px)
                        gsap.to(zoneLabels, {
                            opacity: 1,
                            y: 0,
                            duration: 0.7,
                            stagger: 0.12,
                            delay: 0.1, // Match the ring animation timing
                            ease: 'power3.out'
                        });

                        onComplete();
                    });
                };

                // Fade out the section content as a single unit,
                // then chain the aperture close so content is fully gone
                // before particles become visible
                if (sectionName === 'skills') {
                    gsap.to(section.querySelector('.skills-content'), {
                        opacity: 0,
                        y: -20,
                        duration: 0.15,
                        ease: 'power2.in',
                        onComplete: closeAperture
                    });
                } else if (sectionName === 'projects') {
                    gsap.to(section.querySelector('.section-content'), {
                        opacity: 0,
                        y: -20,
                        duration: 0.15,
                        ease: 'power2.in',
                        onComplete: closeAperture
                    });
                } else if (sectionName === 'contact') {
                    const visibleStep = ContactController.currentStep === 'email'
                        ? ContactController.stepEmail
                        : ContactController.currentStep === 'message'
                            ? ContactController.stepMessage
                            : ContactController.stepThanks;

                    gsap.to(visibleStep, {
                        opacity: 0,
                        y: -20,
                        duration: 0.15,
                        ease: 'power2.in',
                        onComplete: closeAperture
                    });
                } else {
                    gsap.to(section.querySelector('.section-content'), {
                        opacity: 0,
                        y: -20,
                        duration: 0.15,
                        ease: 'power2.in',
                        onComplete: closeAperture
                    });
                }

                // Hide appropriate close button based on section
                if (sectionName === 'projects') {
                    gsap.to(closeBtnProjects, {
                        opacity: 0,
                        duration: 0.2,
                        onComplete: () => {
                            closeBtnProjects.classList.remove('visible');
                            closeBtnProjects.style.opacity = '';
                        }
                    });
                } else {
                    gsap.to(closeBtn, {
                        opacity: 0,
                        duration: 0.2,
                        onComplete: () => {
                            closeBtn.classList.remove('visible');
                            closeBtn.style.opacity = '';
                        }
                    });
                }

            },

            navigationToHero(data, onComplete) {
                const heroLayer = document.getElementById('hero-layer');
                const navLayer = document.getElementById('nav-layer');
                const ctaBtn = document.getElementById('cta-btn');
                const textName = document.getElementById('text-name');
                const textRole = document.getElementById('text-role');

                // Clear any pending hero-to-nav transition intervals
                this.clearPendingTransitions();

                // Fade out all zone rings simultaneously
                Object.keys(ApertureSystem.zoneRings).forEach((zone) => {
                    gsap.killTweensOf(ApertureSystem.zoneRings[zone]);
                    gsap.to(ApertureSystem.zoneRings[zone], {
                        opacity: 0,
                        duration: 0.4,
                        ease: 'power3.in'
                    });
                });

                // Prepare hero layer early (hidden) so particles can initialize during nav fade
                heroLayer.style.display = 'flex';
                heroLayer.style.opacity = '0';

                // Reset text elements to hidden state and restore content
                textName.style.opacity = '0';
                textName.style.filter = 'blur(0px)';
                textRole.style.opacity = '0';
                textRole.style.filter = 'blur(0px)';
                // Restore text content (in case it was cleared by reverse typewriter)
                if (textName.hasAttribute('data-i18n')) {
                    textName.textContent = I18nController.t(textName.getAttribute('data-i18n'));
                }
                if (textRole.hasAttribute('data-i18n')) {
                    textRole.textContent = I18nController.t(textRole.getAttribute('data-i18n'));
                }

                // Reset CTA button state (hidden and disabled until solidifyText completes)
                ctaBtn.style.opacity = '0';
                ctaBtn.style.filter = 'blur(0px)';
                ctaBtn.style.transform = 'scale(1)';
                ctaBtn.style.pointerEvents = 'none';
                ctaBtn.classList.remove('animate-in');

                // Initialize particles early so they're ready
                ParticleSystem.initHeroState();

                const backBtn = document.getElementById('back-hero-btn');

                // Stagger fade-out zone labels (exact reverse of heroToNavigation fade-in)
                gsap.to('.zone-label', {
                    opacity: 0,
                    y: 8,
                    duration: 0.4,
                    stagger: 0.12,
                    ease: 'power3.in'
                });

                // Fade out back button (matched to label timing)
                gsap.to(backBtn, {
                    opacity: 0,
                    y: 8,
                    duration: 0.4,
                    ease: 'power3.in'
                });

                // Fade out nav layer with blur (exact reverse of heroToNavigation fade-in)
                gsap.to(navLayer, {
                    opacity: 0,
                    filter: 'blur(12px)',
                    duration: 0.8,
                    delay: 0.1,
                    ease: 'power2.in',
                    onComplete: () => {
                        navLayer.classList.remove('visible');
                        // Reset zone labels now that nav is hidden (ready for next transition)
                        document.querySelectorAll('.zone-label').forEach(label => {
                            label.style.opacity = 0;
                            label.style.transform = 'translateY(8px)';
                        });
                        // Clear inline styles - let CSS class control visibility
                        this.resetInlineStyles([navLayer]);
                        backBtn.style.opacity = '';
                        backBtn.style.transform = '';
                    }
                });

                // Start fading in hero layer with slight overlap (starts before nav fully fades)
                gsap.to(heroLayer, {
                    opacity: 1,
                    duration: 1.0,
                    delay: 0.35,
                    ease: 'power2.inOut',
                    onStart: () => {
                        // Start text formation as hero fades in
                        ParticleSystem.startTextFormation();
                    },
                    onComplete: () => {
                        // Clear inline styles on hero layer - it's now fully visible
                        this.resetInlineStyles([heroLayer]);
                        // CTA button will be revealed by solidifyText() after animations complete
                        onComplete();
                    }
                });
            },

            sectionToHero(data, onComplete) {
                const sectionName = StateManager.activeSection;
                const section = document.getElementById(`section-${sectionName}`);
                const closeBtn = document.getElementById('close-btn');
                const closeBtnProjects = document.getElementById('close-btn-projects');

                // Hide appropriate close button based on section
                if (sectionName === 'projects') {
                    gsap.to(closeBtnProjects, {
                        opacity: 0,
                        duration: 0.2,
                        onComplete: () => {
                            closeBtnProjects.classList.remove('visible');
                            closeBtnProjects.style.opacity = '';
                        }
                    });
                } else {
                    gsap.to(closeBtn, {
                        opacity: 0,
                        duration: 0.2,
                        onComplete: () => {
                            closeBtn.classList.remove('visible');
                            closeBtn.style.opacity = '';
                        }
                    });
                }

                ApertureSystem.animateClose(CONFIG.apertureDuration * 0.5, () => {
                    section.classList.remove('active');
                    StateManager.clearActiveSection();
                    this.navigationToHero(data, onComplete);
                });
            }
        };

        // ============================================
        // NAVIGATION CONTROLLER
        // ============================================
        const NavigationController = {
            hoveredZone: null,
            _initialized: false,
            _abortController: null,

            init() {
                // Prevent duplicate initialization
                if (this._initialized) return;
                this._initialized = true;

                // Create AbortController for cleanup
                this._abortController = new AbortController();
                const signal = this._abortController.signal;

                const zones = document.querySelectorAll('.zone');
                const closeBtn = document.getElementById('close-btn');
                const closeBtnProjects = document.getElementById('close-btn-projects');
                const backHeroBtn = document.getElementById('back-hero-btn');

                zones.forEach(zone => {
                    const sectionName = zone.dataset.section;

                    zone.addEventListener('mouseenter', () => this.onZoneEnter(sectionName), { signal });
                    zone.addEventListener('mouseleave', () => this.onZoneLeave(sectionName), { signal });
                    zone.addEventListener('click', () => this.onZoneClick(sectionName), { signal });

                    zone.addEventListener('touchstart', () => this.onZoneEnter(sectionName), { passive: true, signal });
                    zone.addEventListener('touchend', (e) => {
                        e.preventDefault();
                        this.onZoneClick(sectionName);
                    }, { signal });
                });

                closeBtn.addEventListener('click', () => this.closeSection(), { signal });
                closeBtn.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    this.closeSection();
                }, { signal });

                // Projects section close button
                closeBtnProjects.addEventListener('click', () => this.closeSection(), { signal });
                closeBtnProjects.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    this.closeSection();
                }, { signal });

                backHeroBtn.addEventListener('click', () => this.backToHero(), { signal });

                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        if (StateManager.activeSection) {
                            this.closeSection();
                        }
                    }
                }, { signal });
            },

            destroy() {
                if (this._abortController) {
                    this._abortController.abort();
                    this._abortController = null;
                }
                this._initialized = false;
            },

            onZoneEnter(sectionName) {
                if (StateManager.current !== AppState.NAVIGATION) return;
                if (StateManager.isTransitioning) return;

                this.hoveredZone = sectionName;

                // Set aperture center for when user clicks and animate ring scale
                const pos = ZONE_POSITIONS[sectionName];
                ApertureSystem.setCenter(pos.x * width, pos.y * height);
                ApertureSystem.setHoveredZone(sectionName);
            },

            onZoneLeave(sectionName) {
                if (StateManager.current !== AppState.NAVIGATION) return;
                if (StateManager.isTransitioning) return;

                this.hoveredZone = null;

                // Animate ring scale back down
                ApertureSystem.clearHoveredZone(sectionName);
            },

            onZoneClick(sectionName) {
                if (StateManager.isTransitioning) return;
                const whooshSound = new Audio('sound/whoosh.mp3');
                whooshSound.play();
                this.hoveredZone = null;
                ApertureSystem.clearHoveredZone(sectionName);
                StateManager.transition(AppState.SECTION_OPEN, { sectionName });
            },

            closeSection() {
                if (!StateManager.activeSection) return;
                const reverseSound = new Audio('sound/reverseW.mp3');
                reverseSound.play();
                StateManager.transition(AppState.NAVIGATION);
            },

            backToHero() {
                if (StateManager.activeSection) {
                    StateManager.transition(AppState.HERO, { fromSection: true });
                } else {
                    StateManager.transition(AppState.HERO);
                }
            }
        };

        // ============================================
        // HERO CONTROLLER
        // ============================================
        const HeroController = {
            _initialized: false,
            _abortController: null,

            init() {
                // Prevent duplicate initialization
                if (this._initialized) return;
                this._initialized = true;

                this._abortController = new AbortController();
                const signal = this._abortController.signal;

                const ctaBtn = document.getElementById('cta-btn');

                ctaBtn.addEventListener('click', () => {
                    // Remove the animate-in class to prevent interference with fade-out
                    ctaBtn.classList.remove('animate-in');

                    // Get text elements
                    const textName = document.getElementById('text-name');
                    const textRole = document.getElementById('text-role');

                    // Fade out all three elements simultaneously with blur
                    gsap.to([ctaBtn, textName, textRole], {
                        opacity: 0,
                        filter: 'blur(4px)',
                        pointerEvents: 'none',
                        duration: 0.75,
                        ease: 'power2.out',
                        overwrite: 'auto',
                        onComplete: () => {
                            // Reset solidified state
                            ParticleSystem.isSolidified = false;

                            // Transition to navigation
                            StateManager.transition(AppState.NAVIGATION);
                        }
                    });
                }, { signal });
            },

            destroy() {
                if (this._abortController) {
                    this._abortController.abort();
                    this._abortController = null;
                }
                this._initialized = false;
            }
        };

        // ============================================
        // CONTACT CONTROLLER (Two-step: Email â†’ Message)
        // ============================================
        const ContactController = {
            // State
            currentStep: 'email', // 'email', 'message', 'thanks'
            email: '',
            _initialized: false,
            _abortController: null,

            // visualViewport state (Issue #3 fix)
            _viewportInitialHeight: null,
            _keyboardOpen: false,
            _resizeTimeout: null,

            // DOM Elements
            emailInput: null,
            messageInput: null,
            preview: null,
            emailHint: null,
            emailBadge: null,
            emailDisplay: null,
            emailEditBtn: null,
            sendBtn: null,
            nextBtn: null,
            stepEmail: null,
            stepMessage: null,
            stepThanks: null,
            resetBtn: null,

            // Font scaling config for message
            fontConfig: {
                maxFont: 3.5,    // rem - starting font size
                minFont: 1.4,   // rem - minimum font size (stays readable)
                charsToMin: 300  // characters at which we hit min font
            },

            // Canvas for measuring text width (reused)
            _measureCanvas: null,
            _maxTextareaHeight: 0,

            getTargetWordCount() {
                const vw = window.innerWidth;
                const vh = window.innerHeight;
                return Math.min(800, Math.max(80, Math.floor((vw * vh) / 4000)));
            },

            // Font scaling config for email (smaller reduction)
            emailFontConfig: {
                maxFont: 4,      // rem - starting font size (matches CSS clamp max)
                minFont: 1.8,    // rem - minimum font size (slightly smaller)
                charsToMin: 40   // emails typically max around 40 chars
            },

            init() {
                // Prevent duplicate initialization
                if (this._initialized) return;
                this._initialized = true;

                this._abortController = new AbortController();
                // Get DOM elements
                this.emailInput = document.getElementById('contact-email-input');
                this.messageInput = document.getElementById('contact-message-input');
                this.preview = document.getElementById('contact-preview');
                this.emailHint = document.getElementById('contact-hint-email');
                this.emailBadge = document.getElementById('contact-email-badge');
                this.emailDisplay = document.getElementById('contact-email-display');
                this.emailEditBtn = document.getElementById('contact-email-edit');
                this.sendBtn = document.getElementById('contact-send-btn');
                this.nextBtn = document.getElementById('contact-next-btn');
                this.stepEmail = document.getElementById('contact-step-email');
                this.stepMessage = document.getElementById('contact-step-message');
                this.stepThanks = document.getElementById('contact-step-thanks');
                this.resetBtn = document.getElementById('contact-reset-btn');

                this.bindEvents();
            },

            bindEvents() {
                const signal = this._abortController.signal;

                // Email input events
                this.emailInput.addEventListener('input', (e) => {
                    this.updatePreview(e.target.value);
                    this.adjustEmailFontSize();
                    this.toggleNextButton();
                    // Remove error state on input
                    this.emailInput.classList.remove('invalid');
                    this.emailHint.classList.remove('error');
                    this.emailHint.textContent = I18nController.t('contact.emailHint');
                }, { signal });

                this.emailInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.validateAndProceed();
                    }
                    if (e.key === 'Escape') {
                        if (this.emailInput.value) {
                            this.emailInput.value = '';
                            this.updatePreview('');
                        } else {
                            NavigationController.closeSection();
                        }
                    }
                }, { signal });

                // Message input events
                this.messageInput.addEventListener('input', (e) => {
                    this.updatePreview(e.target.value);
                    this.adjustMessageFontSize();
                    this.updateMaxHeight();
                    this.autoResizeTextarea();
                    this.toggleSendButton();
                }, { signal });

                this.messageInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        if (this.messageInput.value) {
                            this.messageInput.value = '';
                            this.updatePreview('');
                            this.adjustMessageFontSize();
                            this.updateMaxHeight();
                            this.autoResizeTextarea();
                            this.toggleSendButton();
                        } else {
                            NavigationController.closeSection();
                        }
                    }
                }, { signal });

                // Recalculate max-height on window resize
                window.addEventListener('resize', () => {
                    if (this.currentStep === 'message') {
                        this.updateMaxHeight();
                        this.autoResizeTextarea();
                    }
                }, { signal });

                // Edit email button
                this.emailEditBtn.addEventListener('click', () => {
                    this.goToEmailStep();
                }, { signal });

                // Send button
                this.sendBtn.addEventListener('click', () => {
                    this.submitMessage();
                }, { signal });

                // Next button (email step)
                this.nextBtn.addEventListener('click', () => {
                    this.validateAndProceed();
                }, { signal });

                // Reset button (in thank you view)
                this.resetBtn.addEventListener('click', () => {
                    this.reset();
                    this.focusInput();
                }, { signal });

                // On touch devices: blur input when keyboard is dismissed
                // This handles the case where user taps outside or dismisses keyboard
                if (this.isTouchDevice()) {
                    if (window.visualViewport) {
                        // Issue #3 fix: Use instance properties instead of closure variables
                        this._viewportInitialHeight = window.visualViewport.height;
                        this._keyboardOpen = false;

                        window.visualViewport.addEventListener('resize', () => {
                            const currentHeight = window.visualViewport.height;
                            const heightDiff = currentHeight - this._viewportInitialHeight;

                            // Clear any pending timeout
                            if (this._resizeTimeout) clearTimeout(this._resizeTimeout);

                            // Debounce to wait for resize to stabilize
                            this._resizeTimeout = setTimeout(() => {
                                // Keyboard opened (viewport shrunk significantly)
                                if (heightDiff < -100) {
                                    this._keyboardOpen = true;
                                }
                                // Keyboard closed (viewport back to near original)
                                else if (this._keyboardOpen && heightDiff > -50) {
                                    this._keyboardOpen = false;
                                    // Blur the active input
                                    if (document.activeElement === this.emailInput ||
                                        document.activeElement === this.messageInput) {
                                        document.activeElement.blur();
                                    }
                                }
                            }, 100);
                        }, { signal });
                    }
                }
            },

            destroy() {
                if (this._abortController) {
                    this._abortController.abort();
                    this._abortController = null;
                }
                if (this._resizeTimeout) {
                    clearTimeout(this._resizeTimeout);
                    this._resizeTimeout = null;
                }
                this._initialized = false;
            },

            validateEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            },

            validateAndProceed() {
                const email = this.emailInput.value.trim();

                if (!email) {
                    this.showEmailError(I18nController.t('contact.emailErrorEmpty'));
                    return;
                }

                if (!this.validateEmail(email)) {
                    this.showEmailError(I18nController.t('contact.emailErrorInvalid'));
                    return;
                }

                this.email = email;
                this.goToMessageStep();
            },

            showEmailError(message) {
                this.emailInput.classList.add('invalid');
                this.emailHint.classList.add('error');
                this.emailHint.textContent = message;

                // Remove invalid class after animation
                setTimeout(() => {
                    this.emailInput.classList.remove('invalid');
                }, 400);
            },

            goToMessageStep() {
                // Update email display
                this.emailDisplay.textContent = this.email;

                // Animate transition
                gsap.to(this.stepEmail, {
                    opacity: 0,
                    y: -20,
                    duration: 0.3,
                    ease: 'power2.in',
                    onComplete: () => {
                        this.stepEmail.style.display = 'none';
                        this.stepMessage.style.display = 'flex';
                        this.currentStep = 'message';

                        // Issue #7 fix: Only reinitialize if needed
                        refreshLucideIcons(this.stepMessage);

                        gsap.fromTo(this.stepMessage,
                            { opacity: 0, y: 20 },
                            {
                                opacity: 1,
                                y: 0,
                                duration: 0.4,
                                ease: 'power2.out',
                                onComplete: () => {
                                    this.updateMaxHeight();
                                    this.messageInput.focus();
                                }
                            }
                        );
                    }
                });

                // Clear preview
                this.updatePreview('');
            },

            goToEmailStep() {
                gsap.to(this.stepMessage, {
                    opacity: 0,
                    y: 20,
                    duration: 0.3,
                    ease: 'power2.in',
                    onComplete: () => {
                        this.stepMessage.style.display = 'none';
                        this.stepEmail.style.display = 'flex';
                        this.currentStep = 'email';

                        gsap.fromTo(this.stepEmail,
                            { opacity: 0, y: -20 },
                            {
                                opacity: 1,
                                y: 0,
                                duration: 0.4,
                                ease: 'power2.out',
                                onComplete: () => {
                                    this.emailInput.focus();
                                    this.emailInput.select();
                                }
                            }
                        );
                    }
                });

                // Update preview with email
                this.updatePreview(this.emailInput.value);
            },

            adjustMessageFontSize() {
                const text = this.messageInput.value;
                const charCount = text.length;
                const { maxFont, minFont, charsToMin } = this.fontConfig;

                // Calculate font size based on character count
                // Linear interpolation from maxFont to minFont
                const ratio = Math.min(charCount / charsToMin, 1);
                const fontSize = maxFont - (ratio * (maxFont - minFont));

                // Apply responsive font size using clamp
                const minResponsive = fontSize * 0.6;  // 60% for mobile (stays readable)
                const maxResponsive = fontSize;
                const vwValue = fontSize * 1.5;

                this.messageInput.style.fontSize = `clamp(${minResponsive}rem, ${vwValue}vw, ${maxResponsive}rem)`;
            },

            adjustEmailFontSize() {
                const text = this.emailInput.value;
                const charCount = text.length;
                const { maxFont, minFont, charsToMin } = this.emailFontConfig;

                // Calculate font size based on character count
                // Linear interpolation from maxFont to minFont
                const ratio = Math.min(charCount / charsToMin, 1);
                const fontSize = maxFont - (ratio * (maxFont - minFont));

                // Apply responsive font size using clamp
                const minResponsive = fontSize * 0.5;  // 50% for mobile
                const maxResponsive = fontSize;
                const vwValue = fontSize * 1.5;

                this.emailInput.style.fontSize = `clamp(${minResponsive}rem, ${vwValue}vw, ${maxResponsive}rem)`;
            },

            updateMaxHeight() {
                const computed = window.getComputedStyle(this.messageInput);
                const fontSize = parseFloat(computed.fontSize);
                const lineHeight = parseFloat(computed.lineHeight) || fontSize * 1.2;
                const containerWidth = this.messageInput.clientWidth;
                const targetWords = this.getTargetWordCount();
                const totalChars = targetWords * 6; // avg 5 chars + space per word

                if (!this._measureCanvas) this._measureCanvas = document.createElement('canvas');
                const ctx = this._measureCanvas.getContext('2d');
                ctx.font = `600 ${fontSize}px Inter, sans-serif`;
                const avgCharWidth = ctx.measureText('abcdefghijklmnopqrstuvwxyz ').width / 27;

                const charsPerLine = Math.max(1, Math.floor(containerWidth / avgCharWidth));
                const linesNeeded = Math.ceil(totalChars / charsPerLine);
                const calculated = linesNeeded * lineHeight;

                // Safety cap: never exceed 55% of viewport height
                this._maxTextareaHeight = Math.min(calculated, window.innerHeight * 0.55);
                this.messageInput.style.maxHeight = this._maxTextareaHeight + 'px';
            },

            autoResizeTextarea() {
                this.messageInput.style.height = 'auto';
                const scrollHeight = this.messageInput.scrollHeight;

                if (this._maxTextareaHeight && scrollHeight > this._maxTextareaHeight) {
                    this.messageInput.style.height = this._maxTextareaHeight + 'px';
                    this.messageInput.style.overflowY = 'auto';
                } else {
                    this.messageInput.style.height = scrollHeight + 'px';
                    this.messageInput.style.overflowY = 'hidden';
                }
            },

            toggleSendButton() {
                const hasContent = this.messageInput.value.trim().length > 0;
                if (hasContent) {
                    this.sendBtn.classList.add('visible');
                } else {
                    this.sendBtn.classList.remove('visible');
                }
            },

            toggleNextButton() {
                const hasContent = this.emailInput.value.trim().length > 0;
                if (hasContent) {
                    this.nextBtn.classList.add('visible');
                } else {
                    this.nextBtn.classList.remove('visible');
                }
            },

            updatePreview(text) {
                if (text.length > 0) {
                    this.preview.textContent = text;
                    this.preview.classList.add('visible');
                    // Lighter opacity to not disturb the user
                    const opacity = Math.min(text.length * 0.008, 0.05);
                    this.preview.style.opacity = opacity;
                } else {
                    this.preview.classList.remove('visible');
                    this.preview.style.opacity = 0;
                }
            },

            async submitMessage() {
                const message = this.messageInput.value.trim();
                if (!message || !this.email) return;

                // Prevent double submission
                if (this.isSending) return;
                this.isSending = true;

                // Show loading state
                this.setLoadingState(true);
                this.hideError();

                // Get input position for particle explosion (prepare before async)
                const rect = this.messageInput.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                const fontSize = parseInt(window.getComputedStyle(this.messageInput).fontSize);

                try {
                    // Send email via EmailJS
                    await emailjs.send(
                        'service_5q45bua',
                        'template_c75clya',
                        {
                            email: this.email,
                            message: message
                        }
                    );

                    // Success: Explode the typed text into particles
                    ParticleSystem.createTextExplosion(message, centerX, centerY, fontSize);

                    // Transition to thank you view
                    gsap.to(this.stepMessage, {
                        opacity: 0,
                        y: -20,
                        duration: 0.3,
                        ease: 'power2.in',
                        onComplete: () => {
                            this.stepMessage.style.display = 'none';
                            this.stepThanks.style.display = 'flex';
                            this.currentStep = 'thanks';

                            // Issue #7 fix: Only reinitialize if needed
                            refreshLucideIcons(this.stepThanks);

                            gsap.fromTo(this.stepThanks,
                                { opacity: 0, y: 20 },
                                { opacity: 1, y: 0, duration: 0.5, ease: 'power2.out' }
                            );
                        }
                    });

                    // Clear preview
                    this.updatePreview('');

                } catch (error) {
                    console.error('EmailJS error:', error);

                    // Show detailed error message based on error type
                    let errorMessage = I18nController.t('contact.error.generic');

                    if (!navigator.onLine) {
                        errorMessage = I18nController.t('contact.error.network');
                    } else if (error.status === 400) {
                        errorMessage = I18nController.t('contact.error.validation');
                    } else if (error.status === 401 || error.status === 403) {
                        errorMessage = I18nController.t('contact.error.auth');
                    } else if (error.status === 429) {
                        errorMessage = I18nController.t('contact.error.rateLimit');
                    } else if (error.status >= 500) {
                        errorMessage = I18nController.t('contact.error.server');
                    }

                    this.showError(errorMessage);
                } finally {
                    this.isSending = false;
                    this.setLoadingState(false);
                }
            },

            setLoadingState(isLoading) {
                const btnText = this.sendBtn.querySelector('.btn-text');
                const btnLoadingText = this.sendBtn.querySelector('.btn-loading-text');

                if (isLoading) {
                    this.sendBtn.classList.add('loading');
                    btnText.style.display = 'none';
                    btnLoadingText.style.display = 'inline';
                } else {
                    this.sendBtn.classList.remove('loading');
                    btnText.style.display = 'inline';
                    btnLoadingText.style.display = 'none';
                }
            },

            showError(message) {
                const errorEl = document.getElementById('contact-error-message');
                if (errorEl) {
                    errorEl.textContent = message;
                    errorEl.classList.add('visible');
                }
            },

            hideError() {
                const errorEl = document.getElementById('contact-error-message');
                if (errorEl) {
                    errorEl.classList.remove('visible');
                }
            },

            // Check if device is touch-based (mobile/tablet)
            isTouchDevice() {
                return 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            },

            focusInput() {
                // Don't auto-focus on touch devices to prevent keyboard from opening automatically
                if (this.isTouchDevice()) return;

                setTimeout(() => {
                    if (this.currentStep === 'email' && this.emailInput) {
                        this.emailInput.focus();
                    } else if (this.currentStep === 'message' && this.messageInput) {
                        this.messageInput.focus();
                    }
                }, 500);
            },

            reset() {
                // Reset state
                this.email = '';
                this.currentStep = 'email';
                this.isSending = false;

                // Clear inputs
                if (this.emailInput) {
                    this.emailInput.value = '';
                    this.emailInput.classList.remove('invalid');
                    this.emailInput.style.fontSize = '';
                }
                if (this.messageInput) {
                    this.messageInput.value = '';
                    this.messageInput.style.fontSize = '';
                    this.messageInput.style.height = 'auto';
                }
                if (this.emailHint) {
                    this.emailHint.classList.remove('error');
                    this.emailHint.textContent = I18nController.t('contact.emailHint');
                }

                // Reset send button and next button
                this.sendBtn.classList.remove('visible');
                this.nextBtn.classList.remove('visible');
                this.setLoadingState(false);
                this.hideError();

                // Clear preview
                this.updatePreview('');

                // Reset step visibility (no animation when closing section)
                this.stepEmail.style.display = 'flex';
                this.stepEmail.style.opacity = 1;
                this.stepMessage.style.display = 'none';
                this.stepThanks.style.display = 'none';

                // Issue #3 fix: Reset visualViewport state
                if (this._resizeTimeout) {
                    clearTimeout(this._resizeTimeout);
                    this._resizeTimeout = null;
                }
                this._keyboardOpen = false;
                if (window.visualViewport) {
                    this._viewportInitialHeight = window.visualViewport.height;
                }
            }
        };

        // ============================================
        // SKILLS CONTROLLER
        // ============================================
        const SkillsController = {
            _initialized: false,
            _abortController: null,

            init() {
                // Prevent duplicate initialization
                if (this._initialized) return;
                this._initialized = true;

                this._abortController = new AbortController();
                const signal = this._abortController.signal;

                const categories = document.querySelectorAll('.skill-category');

                categories.forEach(category => {
                    // Handle click/tap for mobile
                    category.addEventListener('click', (e) => {
                        // Toggle active state for touch devices
                        if (window.matchMedia('(hover: none)').matches) {
                            categories.forEach(c => {
                                if (c !== category) c.classList.remove('active');
                            });
                            category.classList.toggle('active');
                        }
                    }, { signal });

                    // Handle touch events
                    category.addEventListener('touchstart', () => {
                        category.classList.add('active');
                    }, { passive: true, signal });

                    category.addEventListener('touchend', () => {
                        // Keep active state on touch devices until another is tapped
                        if (!window.matchMedia('(hover: none)').matches) {
                            setTimeout(() => {
                                category.classList.remove('active');
                            }, 500);
                        }
                    }, { passive: true, signal });
                });

                // Click outside to deactivate on mobile
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.skill-category')) {
                        categories.forEach(c => c.classList.remove('active'));
                    }
                }, { signal });
            },

            // Issue #6 fix: Reset active states when leaving section
            reset() {
                const categories = document.querySelectorAll('.skill-category');
                categories.forEach(c => c.classList.remove('active'));
            },

            destroy() {
                if (this._abortController) {
                    this._abortController.abort();
                    this._abortController = null;
                }
                this._initialized = false;
            }
        };

        // ============================================
        // PROJECTS CONTROLLER
        // ============================================
        const ProjectsController = {
            currentIndex: 0,
            totalProjects: 3,
            track: null,
            slides: null,
            tabs: null,
            prevBtn: null,
            nextBtn: null,
            isAnimating: false,
            animationTimeout: null,
            _initialized: false,
            _abortController: null,
            _lucideInitialized: false,

            init() {
                // Prevent duplicate initialization
                if (this._initialized) return;
                this._initialized = true;

                this._abortController = new AbortController();
                const signal = this._abortController.signal;

                this.track = document.getElementById('projects-track');
                this.slides = document.querySelectorAll('.project-slide');
                this.tabs = document.querySelectorAll('.project-tab');
                this.prevBtn = document.getElementById('project-prev');
                this.nextBtn = document.getElementById('project-next');

                // Tab click handlers
                this.tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const index = parseInt(tab.dataset.project);
                        this.goToProject(index);
                    }, { signal });
                });

                // Arrow click handlers
                this.prevBtn.addEventListener('click', () => this.prev(), { signal });
                this.nextBtn.addEventListener('click', () => this.next(), { signal });

                // Keyboard navigation
                document.addEventListener('keydown', (e) => {
                    if (StateManager.activeSection !== 'projects') return;
                    if (e.key === 'ArrowLeft') this.prev();
                    if (e.key === 'ArrowRight') this.next();
                }, { signal });

                // Gesture navigation (trackpad + touch swipe)
                this.initGestureNavigation(signal);

                // Gallery toggle for Project 2
                this.initGalleryToggle(signal);

                // Issue #7 fix: Only initialize Lucide icons once
                if (typeof lucide !== 'undefined' && !this._lucideInitialized) {
                    lucide.createIcons();
                    this._lucideInitialized = true;
                }
            },

            initGestureNavigation(signal) {
                const carousel = document.querySelector('.projects-carousel');
                if (!carousel) return;

                // --- Helpers ---
                // Check if an event target is inside a case-study-scroll container
                const getCaseStudyScroll = (target) => target.closest('.case-study-scroll');

                // Determine if a case-study-scroll is at its horizontal boundary
                const isAtBoundary = (scrollEl, direction) => {
                    // direction: -1 = swiping right (want prev), +1 = swiping left (want next)
                    const tolerance = 2; // px rounding tolerance
                    if (direction < 0) {
                        // At the very start?
                        return scrollEl.scrollLeft <= tolerance;
                    }
                    // At the very end?
                    return scrollEl.scrollLeft + scrollEl.clientWidth >= scrollEl.scrollWidth - tolerance;
                };

                // --- Wheel (trackpad two-finger scroll) ---
                let wheelAccum = 0;
                let wheelTimer = null;
                const WHEEL_THRESHOLD = 50;

                carousel.addEventListener('wheel', (e) => {
                    if (StateManager.activeSection !== 'projects') return;
                    if (this.isAnimating) return;

                    // Only react to primarily-horizontal gestures
                    if (Math.abs(e.deltaX) < Math.abs(e.deltaY)) return;

                    const direction = e.deltaX > 0 ? 1 : -1; // +1 = next, -1 = prev

                    // If inside a case-study-scroll, only intercept at boundaries
                    const caseScroll = getCaseStudyScroll(e.target);
                    if (caseScroll) {
                        if (!isAtBoundary(caseScroll, direction)) return;
                        // At boundary â€” prevent the case study from rubber-banding
                        e.preventDefault();
                    } else {
                        e.preventDefault();
                    }

                    // Accumulate delta and trigger when threshold exceeded
                    wheelAccum += e.deltaX;
                    clearTimeout(wheelTimer);
                    wheelTimer = setTimeout(() => { wheelAccum = 0; }, 200);

                    if (Math.abs(wheelAccum) >= WHEEL_THRESHOLD) {
                        if (wheelAccum > 0) this.next();
                        else this.prev();
                        wheelAccum = 0;
                    }
                }, { signal, passive: false });

                // --- Touch swipe ---
                let touchStartX = 0;
                let touchStartY = 0;
                let touchDeltaX = 0;
                let isSwiping = false;
                let touchCaseScroll = null;
                const SWIPE_THRESHOLD = 50;

                carousel.addEventListener('touchstart', (e) => {
                    if (StateManager.activeSection !== 'projects') return;
                    touchStartX = e.touches[0].clientX;
                    touchStartY = e.touches[0].clientY;
                    touchDeltaX = 0;
                    isSwiping = false;
                    touchCaseScroll = getCaseStudyScroll(e.target);
                }, { signal, passive: true });

                carousel.addEventListener('touchmove', (e) => {
                    if (StateManager.activeSection !== 'projects') return;
                    const dx = e.touches[0].clientX - touchStartX;
                    const dy = e.touches[0].clientY - touchStartY;

                    // Lock into horizontal swipe only if horizontal displacement dominates
                    if (!isSwiping) {
                        if (Math.abs(dx) > 10 && Math.abs(dx) > Math.abs(dy)) {
                            isSwiping = true;
                        } else if (Math.abs(dy) > 10) {
                            // Vertical gesture â€” bail out entirely
                            isSwiping = false;
                            touchCaseScroll = null;
                            return;
                        }
                    }

                    if (isSwiping) {
                        touchDeltaX = dx;
                    }
                }, { signal, passive: true });

                carousel.addEventListener('touchend', () => {
                    if (!isSwiping || this.isAnimating) return;

                    const direction = touchDeltaX < 0 ? 1 : -1; // swipe-left = next

                    // If inside case-study-scroll, only navigate at boundaries
                    if (touchCaseScroll) {
                        if (!isAtBoundary(touchCaseScroll, direction)) {
                            isSwiping = false;
                            touchCaseScroll = null;
                            return;
                        }
                    }

                    if (Math.abs(touchDeltaX) >= SWIPE_THRESHOLD) {
                        if (direction > 0) this.next();
                        else this.prev();
                    }

                    isSwiping = false;
                    touchCaseScroll = null;
                }, { signal, passive: true });
            },

            initGalleryToggle(signal) {
                const toggleBtns = document.querySelectorAll('.gallery-toggle-btn');

                // Project 2 case studies
                const userCaseStudy = document.getElementById('case-study-user');
                const adminCaseStudy = document.getElementById('case-study-admin');

                // Project 3 views
                const project3UserView = document.getElementById('project3-user-view');
                const project3AdminView = document.getElementById('project3-admin-view');

                toggleBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const view = btn.dataset.view;
                        const projectNum = btn.dataset.project;

                        // Get sibling toggle buttons (within same gallery-toggle container)
                        const siblingBtns = btn.parentElement.querySelectorAll('.gallery-toggle-btn');
                        siblingBtns.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');

                        // Handle Project 2 case study toggle
                        if (projectNum === '2') {
                            if (view === 'user') {
                                adminCaseStudy.classList.remove('active');
                                userCaseStudy.classList.add('active');
                                // Reset scroll position
                                const userScroll = document.getElementById('user-scroll');
                                if (userScroll) userScroll.scrollLeft = 0;
                                this.updateCaseStudyDots('user-scroll', 0);
                            } else {
                                userCaseStudy.classList.remove('active');
                                adminCaseStudy.classList.add('active');
                                // Reset scroll position
                                const adminScroll = document.getElementById('admin-scroll');
                                if (adminScroll) adminScroll.scrollLeft = 0;
                                this.updateCaseStudyDots('admin-scroll', 0);
                            }
                        }

                        // Handle Project 3 toggle
                        if (projectNum === '3') {
                            if (view === 'user') {
                                gsap.to(project3AdminView, {
                                    opacity: 0,
                                    duration: 0.2,
                                    onComplete: () => {
                                        project3AdminView.style.display = 'none';
                                        project3UserView.style.display = 'block';
                                        gsap.fromTo(project3UserView, { opacity: 0 }, { opacity: 1, duration: 0.3 });
                                    }
                                });
                            } else {
                                gsap.to(project3UserView, {
                                    opacity: 0,
                                    duration: 0.2,
                                    onComplete: () => {
                                        project3UserView.style.display = 'none';
                                        project3AdminView.style.display = 'block';
                                        gsap.fromTo(project3AdminView, { opacity: 0 }, { opacity: 1, duration: 0.3 });
                                    }
                                });
                            }
                        }
                    }, { signal });
                });

                // Initialize case study navigation
                this.initCaseStudyNavigation(signal);
            },

            initCaseStudyNavigation(signal) {
                // Handle navigation arrows
                document.querySelectorAll('.case-study-nav').forEach(navBtn => {
                    navBtn.addEventListener('click', () => {
                        const scrollId = navBtn.dataset.scroll;
                        const scrollContainer = document.getElementById(scrollId);
                        if (!scrollContainer) return;

                        const isVertical = window.innerWidth < 1024;
                        const panelSize = isVertical ? scrollContainer.offsetHeight : scrollContainer.offsetWidth;
                        const currentScroll = isVertical ? scrollContainer.scrollTop : scrollContainer.scrollLeft;
                        const currentIndex = Math.round(currentScroll / panelSize);
                        const panels = scrollContainer.querySelectorAll('.case-study-intro, .case-study-panel');
                        const maxIndex = panels.length - 1;

                        let newIndex;
                        if (navBtn.classList.contains('prev')) {
                            newIndex = Math.max(0, currentIndex - 1);
                        } else {
                            newIndex = Math.min(maxIndex, currentIndex + 1);
                        }

                        if (isVertical) {
                            scrollContainer.scrollTo({ top: panelSize * newIndex, behavior: 'smooth' });
                        } else {
                            scrollContainer.scrollTo({ left: panelSize * newIndex, behavior: 'smooth' });
                        }

                        this.updateCaseStudyDots(scrollId, newIndex);
                    }, { signal });
                });

                // Handle progress dots
                document.querySelectorAll('.case-study-progress').forEach(progressContainer => {
                    const scrollId = progressContainer.dataset.scroll;
                    progressContainer.querySelectorAll('.case-study-dot').forEach(dot => {
                        dot.addEventListener('click', () => {
                            const index = parseInt(dot.dataset.index);
                            const scrollContainer = document.getElementById(scrollId);
                            if (!scrollContainer) return;

                            const isVertical = window.innerWidth < 1024;
                            const panelSize = isVertical ? scrollContainer.offsetHeight : scrollContainer.offsetWidth;

                            if (isVertical) {
                                scrollContainer.scrollTo({ top: panelSize * index, behavior: 'smooth' });
                            } else {
                                scrollContainer.scrollTo({ left: panelSize * index, behavior: 'smooth' });
                            }

                            this.updateCaseStudyDots(scrollId, index);
                        }, { signal });
                    });
                });

                // Issue #4 fix: Handle scroll updates for progress dots with signal
                document.querySelectorAll('.case-study-scroll').forEach(scrollContainer => {
                    let scrollTimeout;
                    scrollContainer.addEventListener('scroll', () => {
                        clearTimeout(scrollTimeout);
                        scrollTimeout = setTimeout(() => {
                            const isVertical = window.innerWidth < 1024;
                            const panelSize = isVertical ? scrollContainer.offsetHeight : scrollContainer.offsetWidth;
                            const currentScroll = isVertical ? scrollContainer.scrollTop : scrollContainer.scrollLeft;
                            const currentIndex = Math.round(currentScroll / panelSize);
                            this.updateCaseStudyDots(scrollContainer.id, currentIndex);
                        }, 50);
                    }, { signal });
                });
            },

            updateCaseStudyDots(scrollId, activeIndex) {
                const progressContainer = document.querySelector(`.case-study-progress[data-scroll="${scrollId}"]`);
                if (!progressContainer) return;

                progressContainer.querySelectorAll('.case-study-dot').forEach((dot, index) => {
                    dot.classList.toggle('active', index === activeIndex);
                });
            },

            goToProject(index) {
                // Failsafe: if isAnimating has been stuck for more than 1 second, force reset it
                if (this.isAnimating && this.animationTimeout) {
                    clearTimeout(this.animationTimeout);
                    this.isAnimating = false;
                }

                if (this.isAnimating || index === this.currentIndex) return;
                if (index < 0 || index >= this.totalProjects) return;

                this.isAnimating = true;
                const previousIndex = this.currentIndex;
                this.currentIndex = index;

                // Kill any existing GSAP animations on slides to prevent conflicts
                this.slides.forEach(slide => {
                    gsap.killTweensOf(slide);
                    gsap.killTweensOf(slide.querySelector('.project-content'));
                    const content = slide.querySelector('.project-content');
                    if (content && content.children) {
                        gsap.killTweensOf(content.children);
                    }
                });

                // Fade out current slide, fade in new slide
                this.slides.forEach((slide, i) => {
                    if (i === previousIndex) {
                        slide.classList.remove('active');
                        // Explicitly set opacity as backup
                        slide.style.opacity = '0';
                    }
                    if (i === index) {
                        slide.classList.add('active');
                        // Explicitly set opacity as backup
                        slide.style.opacity = '1';
                        // Reset scroll position when switching projects
                        slide.scrollTop = 0;
                    }
                });

                // Update tabs
                this.tabs.forEach((tab, i) => {
                    tab.classList.toggle('active', i === index);
                });

                // Update arrow states
                this.updateArrows();

                // Issue #7 fix: Only reinitialize Lucide icons if needed
                refreshLucideIcons(this.slides[index]);

                // Reset animation lock when CSS transition actually ends
                // Use transitionend event instead of fixed timeout to stay in sync with CSS
                const activeSlide = this.slides[index];

                const onTransitionEnd = (e) => {
                    // Only respond to opacity transitions on the slide itself
                    if (e.propertyName !== 'opacity' || e.target !== activeSlide) return;

                    activeSlide.removeEventListener('transitionend', onTransitionEnd);
                    clearTimeout(this.animationTimeout);
                    this.isAnimating = false;
                    this.animationTimeout = null;
                };

                activeSlide.addEventListener('transitionend', onTransitionEnd);

                // Fallback timeout in case transitionend doesn't fire (e.g., display:none, no transition)
                // Set slightly longer than expected transition to avoid race conditions
                this.animationTimeout = setTimeout(() => {
                    activeSlide.removeEventListener('transitionend', onTransitionEnd);
                    this.isAnimating = false;
                    this.animationTimeout = null;
                }, 800);
            },

            prev() {
                if (this.currentIndex > 0) {
                    this.goToProject(this.currentIndex - 1);
                }
            },

            next() {
                if (this.currentIndex < this.totalProjects - 1) {
                    this.goToProject(this.currentIndex + 1);
                }
            },

            updateArrows() {
                this.prevBtn.disabled = this.currentIndex === 0;
                this.nextBtn.disabled = this.currentIndex === this.totalProjects - 1;
            },

            // Reset to first project when section opens
            reset() {
                // Clear any stuck animation state
                if (this.animationTimeout) {
                    clearTimeout(this.animationTimeout);
                    this.animationTimeout = null;
                }
                this.isAnimating = false;
                this.currentIndex = 0;

                // Kill all GSAP animations on slides
                this.slides.forEach(slide => {
                    gsap.killTweensOf(slide);
                    const content = slide.querySelector('.project-content');
                    if (content) {
                        gsap.killTweensOf(content);
                        if (content.children) {
                            gsap.killTweensOf(content.children);
                        }
                    }
                });

                // Show only the first slide with explicit opacity
                this.slides.forEach((slide, i) => {
                    slide.classList.toggle('active', i === 0);
                    slide.style.opacity = i === 0 ? '1' : '0';
                    slide.scrollTop = 0;
                });

                this.tabs.forEach((tab, i) => {
                    tab.classList.toggle('active', i === 0);
                });
                this.updateArrows();

                // Reset Project 2 case study to user view
                const userCaseStudy = document.getElementById('case-study-user');
                const adminCaseStudy = document.getElementById('case-study-admin');

                if (userCaseStudy && adminCaseStudy) {
                    userCaseStudy.classList.add('active');
                    adminCaseStudy.classList.remove('active');
                    // Reset scroll positions
                    const userScroll = document.getElementById('user-scroll');
                    const adminScroll = document.getElementById('admin-scroll');
                    if (userScroll) userScroll.scrollLeft = 0;
                    if (adminScroll) adminScroll.scrollLeft = 0;
                    // Reset dots
                    this.updateCaseStudyDots('user-scroll', 0);
                    this.updateCaseStudyDots('admin-scroll', 0);
                }

                // Reset Project 3 toggle to user view
                const project3UserView = document.getElementById('project3-user-view');
                const project3AdminView = document.getElementById('project3-admin-view');

                if (project3UserView && project3AdminView) {
                    // Issue #8 fix: Kill any running GSAP animations before resetting
                    gsap.killTweensOf(project3UserView);
                    gsap.killTweensOf(project3AdminView);

                    project3UserView.style.display = 'block';
                    project3UserView.style.opacity = '1';
                    project3AdminView.style.display = 'none';
                    project3AdminView.style.opacity = '';
                }

                // Reset all toggle buttons to user view active state
                const toggleBtns = document.querySelectorAll('.gallery-toggle-btn');
                toggleBtns.forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.view === 'user');
                });
            },

            destroy() {
                if (this._abortController) {
                    this._abortController.abort();
                    this._abortController = null;
                }
                if (this.animationTimeout) {
                    clearTimeout(this.animationTimeout);
                    this.animationTimeout = null;
                }
                this._initialized = false;
            },

            // Animate content in when section opens
            animateIn() {
                const section = document.getElementById('section-projects');
                const header = section.querySelector('.projects-header');
                const currentSlide = section.querySelector(`.project-slide[data-index="${this.currentIndex}"]`);
                const arrows = section.querySelectorAll('.project-nav-arrow');

                // Animate header (tabs)
                gsap.fromTo(header,
                    { opacity: 0, y: -20 },
                    { opacity: 1, y: 0, duration: 0.5, delay: CONFIG.apertureDuration * 0.5, ease: 'power3.out' }
                );

                // Animate current project content
                if (currentSlide) {
                    const content = currentSlide.querySelector('.project-content');
                    const elements = content.children;

                    gsap.fromTo(elements,
                        { opacity: 0, y: 30 },
                        {
                            opacity: 1,
                            y: 0,
                            duration: 0.5,
                            stagger: 0.1,
                            delay: CONFIG.apertureDuration * 0.6,
                            ease: 'power3.out'
                        }
                    );
                }

                // Animate arrows
                gsap.fromTo(arrows,
                    { opacity: 0, scale: 0.8 },
                    { opacity: 1, scale: 1, duration: 0.4, delay: CONFIG.apertureDuration * 0.7, ease: 'power2.out' }
                );
            },

            // Animate content out when section closes
            animateOut() {
                const section = document.getElementById('section-projects');
                const header = section.querySelector('.projects-header');
                const currentSlide = section.querySelector(`.project-slide[data-index="${this.currentIndex}"]`);
                const arrows = section.querySelectorAll('.project-nav-arrow');

                gsap.to([header, ...arrows], {
                    opacity: 0,
                    duration: 0.3,
                    ease: 'power2.in'
                });

                if (currentSlide) {
                    const content = currentSlide.querySelector('.project-content');
                    const elements = [...content.children].reverse();

                    gsap.to(elements, {
                        opacity: 0,
                        y: -20,
                        duration: 0.3,
                        stagger: 0.05,
                        ease: 'power2.in'
                    });
                }
            }
        };

        // ============================================
        // MAIN ANIMATION LOOP
        // ============================================
        // Issue #2 fix: Add visibility tracking and state-aware throttling
        let animationFrameId = null;
        let isDocumentVisible = true;
        let lastAnimationTime = 0;
        const MIN_FRAME_TIME = 16; // ~60fps cap

        // Handle visibility changes to pause/resume animation
        document.addEventListener('visibilitychange', () => {
            isDocumentVisible = !document.hidden;
            if (isDocumentVisible && !animationFrameId) {
                lastAnimationTime = performance.now();
                animationFrameId = requestAnimationFrame(animate);
            }
        });

        function animate(timestamp) {
            // Issue #2 fix: Stop loop when document is hidden
            if (!isDocumentVisible) {
                animationFrameId = null;
                return;
            }

            animationFrameId = requestAnimationFrame(animate);

            // Issue #2 fix: Throttle frame rate when in inactive sections
            const deltaTime = timestamp - lastAnimationTime;
            const currentState = StateManager.current;
            const isInSection = currentState === AppState.SECTION_OPEN;
            const hasExplosionParticles = ParticleSystem.explosionParticles.length > 0;

            // Skip frame if in section with no active animations (throttle to ~15fps)
            // Keep full speed during aperture animations
            if (isInSection && !hasExplosionParticles && !ApertureSystem.isAnimating && deltaTime < 66) {
                return;
            }

            // Normal frame rate throttling
            if (deltaTime < MIN_FRAME_TIME) {
                return;
            }

            lastAnimationTime = timestamp;

            particleCtx.clearRect(0, 0, width, height);
            apertureCtx.clearRect(0, 0, width, height);

            const hoveredZone = NavigationController.hoveredZone;
            const now = performance.now();

            if (ApertureSystem.state < 1) {
                ParticleSystem.update(hoveredZone, now);
                ParticleSystem.draw(particleCtx);
            }

            // Draw explosion particles even when aperture is open
            if (ApertureSystem.state >= 1) {
                ParticleSystem.explosionParticles = ParticleSystem.explosionParticles.filter(p => p.alpha > 0);
                ParticleSystem.explosionParticles.forEach(p => {
                    p.update();
                    p.draw(particleCtx);
                });
            }

            ApertureSystem.draw(apertureCtx);
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        async function init() {
            width = particleCanvas.width = apertureCanvas.width = window.innerWidth;
            height = particleCanvas.height = apertureCanvas.height = window.innerHeight;

            // Initialize i18n first
            await I18nController.init();

            // Initialize EmailJS
            emailjs.init('6xclFYMoBC1fgWG1M');

            HeroController.init();
            NavigationController.init();
            ContactController.init();
            SkillsController.init();
            ProjectsController.init();

            ParticleSystem.initHeroState();
            lastAnimationTime = performance.now();
            animationFrameId = requestAnimationFrame(animate);

            document.fonts.ready.then(() => {
                ParticleSystem.initHeroState();
                setTimeout(() => {
                    ParticleSystem.startTextFormation();
                }, 800);
            });
        }

        // Event Listeners
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                width = particleCanvas.width = apertureCanvas.width = window.innerWidth;
                height = particleCanvas.height = apertureCanvas.height = window.innerHeight;

                if (StateManager.current === AppState.HERO && !ParticleSystem.isDusting) {
                    // Hide CTA until solidifyText completes again after re-formation
                    const ctaBtn = document.getElementById('cta-btn');
                    ctaBtn.style.opacity = '0';
                    ctaBtn.style.pointerEvents = 'none';
                    ParticleSystem.initHeroState();
                    setTimeout(() => ParticleSystem.startTextFormation(), 100);
                } else if (StateManager.current === AppState.NAVIGATION || StateManager.current === AppState.SECTION_OPEN) {
                    ParticleSystem.initNavigationState();
                }
            }, 250);
        });

        document.addEventListener('mousemove', (e) => {
            mouse.x = e.clientX;
            mouse.y = e.clientY;
        });

        document.addEventListener('touchmove', (e) => {
            if (e.touches.length > 0) {
                mouse.x = e.touches[0].clientX;
                mouse.y = e.touches[0].clientY;
            }
        }, { passive: true });

        // Start
        init();
    </script>
</body>
</html>
